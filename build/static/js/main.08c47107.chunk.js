(this.webpackJsonpabrowse=this.webpackJsonpabrowse||[]).push([[0],{104:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(9),o=n.n(i),s=(n(79),n(69)),c=n(17),l=n.n(c),u=n(25),h=n(12),d=n(13),f=n(14),p=n(15),m=n(134),v=n(137),g=n(11),w={clustal:{G:"orange",P:"orange",S:"orange",T:"orange",H:"red",K:"red",R:"red",F:"blue",W:"blue",Y:"blue",I:"green",L:"green",M:"green",V:"green"},lesk:{G:"orange",A:"orange",S:"orange",T:"orange",C:"green",V:"green",I:"green",L:"green",P:"green",F:"green",Y:"green",M:"green",W:"green",N:"magenta",Q:"magenta",H:"magenta",D:"red",E:"red",K:"blue",R:"blue"},maeditor:{A:"lightgreen",G:"lightgreen",C:"green",D:"darkgreen",E:"darkgreen",N:"darkgreen",Q:"darkgreen",I:"blue",L:"blue",M:"blue",V:"blue",F:"#c8a2c8",W:"#c8a2c8",Y:"#c8a2c8",H:"darkblue",K:"orange",R:"orange",P:"pink",S:"red",T:"red"},cinema:{H:"blue",K:"blue",R:"blue",D:"red",E:"red",S:"green",T:"green",N:"green",Q:"green",A:"white",V:"white",L:"white",I:"white",M:"white",F:"magenta",W:"magenta",Y:"magenta",P:"brown",G:"brown",C:"yellow",B:"gray",Z:"gray",X:"gray","-":"gray",".":"gray"}},b=(n(82),n(39)),y=n.n(b),k=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,r,a,i,o,s,c,u,h;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.branches,r=t.rowData,a=t.id,i=(i=t.gapChar)||"-",o={},20,s=Math.log(20)/Math.log(2),.001,c=y.a.models.makeGappedModel({model:y.a.models[y.a.defaultModel],deletionRate:.001,gapChar:i}),u=y.a.getNodePostProfiles({branchList:n,nodeSeq:r,postProbThreshold:.01,model:c,defaultGapChar:i}),h=u.nodeProfile,Object.keys(h).forEach((function(e){o[e]=h[e].map((function(e){if(e[i]>=.5)return i;var t=Object.keys(e).filter((function(e){return e!==i})).sort((function(t,n){return e[t]-e[n]})),n=t.reduce((function(t,n){return t+e[n]}),0),r=t.map((function(t){return e[t]/n})),a=r.reduce((function(e,t){return e-t*Math.log(t)}),0)/Math.log(2);return t.map((function(e,t){return[e,r[t]*(s-a)/s]}))}))})),e.abrupt("return",{id:a,ancestralRowData:o});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=n(60),C=n.n(S),D=n(49),E=n.n(D),x=n(61),R=n(62),M=n.n(R),A=n(63),L=n.n(A),O=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).canvasRef=a.a.createRef(),r}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props.computedTreeConfig.treeWidth,t=this.props.treeLayout.treeHeight;return a.a.createElement("div",{className:"MSA-tree",style:{minWidth:e}},a.a.createElement("canvas",{className:"MSA-tree-canvas",ref:this.canvasRef,width:e,height:t,style:{top:-this.props.scrollTop}}))}},{key:"componentDidMount",value:function(){this.renderTree(),this.canvasRef.current.addEventListener("click",this.handleClick.bind(this))}},{key:"componentWillUnmount",value:function(){this.canvasRef.current.removeEventListener("click",this.handleClick.bind(this))}},{key:"componentDidUpdate",value:function(){this.renderTree()}},{key:"renderTree",value:function(){var e=this.props,t=e.treeIndex,n=e.treeLayout,r=e.computedView,a=e.computedTreeConfig,i=r.collapsed,o=r.ancestorCollapsed,s=r.forceDisplayNode,c=r.nodeScale,l=a.treeWidth,u=a.branchStrokeStyle,h=a.treeStrokeWidth,d=a.rowConnectorDash,f=a.nodeHandleRadius,p=a.nodeHandleFillStyle,m=a.collapsedNodeHandleFillStyle,v=n.nx,g=n.ny,w=this.canvasRef.current,b=w.getContext("2d");b.setTransform(1,0,0,1,0,0),b.globalAlpha=1,b.clearRect(0,0,w.width,w.height),b.strokeStyle=u,b.fillStyle=u,b.lineWidth=h;var y=function(e){var t=c[e];b.globalAlpha="undefined"===typeof t||s[e]?1:t},k=t.nodes.filter((function(e){return!o[e]&&t.children[e].length}));t.nodes.forEach((function(e){o[e]||(t.children[e].length||(y(e),b.setLineDash([]),b.beginPath(),b.fillRect(v[e],g[e]-f,1,2*f)),t.children[e].length&&!i[e]&&(b.setLineDash([]),t.children[e].forEach((function(t){y(t),b.beginPath(),b.moveTo(v[e],g[e]),b.lineTo(v[e],g[t]),b.lineTo(v[t],g[t]),b.stroke()}))),b.globalAlpha=1,(0===t.children[e].length||s[e])&&(y(e),b.setLineDash(d),b.beginPath(),b.moveTo(v[e],g[e]),b.lineTo(l,g[e]),b.stroke()))})),b.strokeStyle=u,b.setLineDash([]),k.forEach((function(e){y(e),function(e){b.beginPath(),b.arc(v[e],g[e],f,0,2*Math.PI)}(e),i[e]||s[e]&&!1!==i[e]?b.fillStyle=m:(b.fillStyle=p,b.stroke()),b.fill()})),this.nodesWithHandles=k}},{key:"handleClick",value:function(e){e.preventDefault();var t,n,r=this.props.treeLayout,a=parseInt(e.offsetX),i=parseInt(e.offsetY);this.nodesWithHandles.forEach((function(e){var o=Math.pow(a-r.nx[e],2)+Math.pow(i-r.ny[e],2);("undefined"===typeof n||o<n)&&(n=o,t=e)})),t&&n<=Math.pow(this.props.config.nodeHandleClickRadius,2)&&this.props.handleNodeClick(t)}}]),n}(r.Component),T=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.data,r=t.computedFontConfig,i=t.treeIndex,o=t.config,s=t.computedView,c=t.treeLayout,l=n.structure||{},u=o.nameDivWidth,h=r.nameFontName,d=r.nameFontSize,f=c.nodeHeight;return a.a.createElement("div",{className:"MSA-alignment-names",style:{fontFamily:h,fontSize:d+"px",maxWidth:u}},a.a.createElement("div",{className:"MSA-alignment-names-content",style:{top:-this.props.scrollTop}},i.nodes.filter((function(e){return s.nodeVisible[e]})).map((function(t,n){var r={height:f[t]+"px"},i=e.props.view.nodeScale[t];return"undefined"!==typeof i&&1!==i&&(r.transform="scale(1,"+i+")",r.opacity=i),a.a.createElement("div",{className:"MSA-alignment-name",key:t,style:r},l[t]?a.a.createElement("span",{className:"MSA-alignment-name-link",onClick:function(){return e.props.handleNameClick(t)},style:{fontFamily:h,fontSize:d+"px"}},t):a.a.createElement("span",null," ",t," "))}))))}}]),n}(r.Component),j=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={clientWidth:0,clientHeight:0},r.canvasRef=a.a.createRef(),r}return Object(d.a)(n,[{key:"render",value:function(){var e=this.getDimensions(),t=e.top,n=e.left,r=e.width,i=e.height;return a.a.createElement("canvas",{ref:this.canvasRef,className:"MSA-alignment-canvas",width:r,height:i,style:{top:t,left:n}})}},{key:"getColor",value:function(e){var t=this.props.computedFontConfig.color;return t[e.toUpperCase()]||t.default||"black"}},{key:"getOffscreenRatio",value:function(){return 1}},{key:"getDimensions",value:function(){var e=this.props,t=e.scrollLeft,n=e.scrollTop,r=this.state,a=r.clientWidth,i=r.clientHeight,o=this.getOffscreenRatio(),s=o*a,c=o*i,l=Math.max(0,n-c),u=Math.max(0,t-s),h=Math.min(this.props.treeLayout.treeHeight,n+i+c),d=Math.min(this.props.alignLayout.alignWidth,t+a+s);return{top:l,left:u,bottom:h,right:d,width:d-u,height:h-l}}},{key:"setClientSize",value:function(e,t){e===this.state.clientWidth&&t===this.state.clientHeight||this.setState({clientWidth:e,clientHeight:t})}},{key:"componentDidMount",value:function(){this.renderVisibleRegion()}},{key:"componentDidUpdate",value:function(){this.renderVisibleRegion()}},{key:"renderVisibleRegion",value:function(){var e,t,n=this,r=this.canvasRef.current,a=r.getContext("2d"),i=this.getDimensions(),o=i.top,s=i.left,c=i.bottom,l=i.right,u=this.props,h=u.computedFontConfig,d=u.treeLayout,f=u.alignLayout,p=u.treeIndex,m=u.alignIndex,v=u.data.rowData;a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,a.clearRect(0,0,r.width,r.height),a.font=h.charFont;for(var g=e=0;g<d.rowHeight.length&&d.rowY[g]<c;++g)d.rowY[g]<o&&(e=g),t=g;for(var w=function(r){var i=f.computedColScale[r],c=f.colX[r],l=f.colWidth[r];if(i&&c+l>=s)for(var u=function(e){var t=d.computedRowScale[e],l=d.rowY[e],u=d.rowHeight[e],h=v[p.nodes[e]];if(u&&h){a.globalAlpha=Math.min(i,t);var f=h[r];if("string"===typeof f)a.setTransform(i,0,0,t,c-s,l+u-o),a.fillStyle=n.getColor(f),a.fillText(f,0,0);else{var m=0;f.forEach((function(e){var r=e[0],h=e[1];a.setTransform(i,0,0,t*h,c-s,l+u*(1-m)-o),a.fillStyle=n.getColor(r),a.fillText(r,0,0),m+=h}))}}},h=e;h<=t;++h)u(h)},b=0;b<m.columns&&0<l;++b)w(b)}}]),n}(r.Component),F=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).rowsDivRef=a.a.createRef(),r.alignCanvasRef=a.a.createRef(),r}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props.treeLayout.treeHeight,t=this.props.alignLayout.alignWidth;return a.a.createElement("div",{className:"MSA-alignment-rows",ref:this.rowsDivRef,onClick:this.handleClick.bind(this),onMouseMove:this.handleMouseMove.bind(this),onScroll:this.handleScroll.bind(this),onMouseDown:this.handleMouseDown.bind(this)},a.a.createElement(j,{ref:this.alignCanvasRef,data:this.props.data,treeIndex:this.props.treeIndex,alignIndex:this.props.alignIndex,treeLayout:this.props.treeLayout,alignLayout:this.props.alignLayout,computedFontConfig:this.props.computedFontConfig,scrollLeft:this.props.scrollLeft,scrollTop:this.props.scrollTop}),a.a.createElement("div",{className:"MSA-alignment-rows-back",style:{width:t,height:e}}))}},{key:"componentDidUpdate",value:function(){this.setScrollPos(),this.setClientSize()}},{key:"componentDidMount",value:function(){this.setScrollPos(),this.setClientSize(),window.addEventListener("resize",this.setClientSize.bind(this))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.setClientSize.bind(this))}},{key:"setClientSize",value:function(){this.props.setClientSize(this.rowsDivRef.current.clientWidth,this.rowsDivRef.current.clientHeight),this.alignCanvasRef.current.setClientSize(this.rowsDivRef.current.clientWidth,this.rowsDivRef.current.clientHeight)}},{key:"setScrollPos",value:function(e){e=e||this.props,this.rowsDivRef.current.scrollLeft=e.scrollLeft,this.rowsDivRef.current.scrollTop=e.scrollTop}},{key:"handleClick",value:function(e){this.props.handleAlignCharClick(this.resolveAlignCoords(e))}},{key:"handleMouseMove",value:function(e){var t=this.resolveAlignCoords(e);this.lastCoords&&t.row===this.lastCoords.row&&t.column===this.lastCoords.column||(this.props.handleAlignCharMouseOut(this.lastCoords),this.props.handleAlignCharMouseOver(t),this.lastCoords=t)}},{key:"handleMouseDown",value:function(e){this.props.handleMouseDown(e)}},{key:"handleScroll",value:function(e){this.props.handleScroll(this.rowsDivRef.current.scrollLeft,this.rowsDivRef.current.scrollTop)}},{key:"resolveAlignCoords",value:function(e){var t,n,r=this.props,a=r.treeIndex,i=r.alignIndex,o=r.treeLayout,s=r.alignLayout,c=r.data.rowData,l=parseInt(e.nativeEvent.offsetX),u=parseInt(e.nativeEvent.offsetY);for(t=0;t<a.nodes.length-1&&!(o.rowY[t]<=u&&o.rowY[t]+o.rowHeight[t]>u);++t);for(n=0;n<i.columns-1&&!(s.colX[n]<=l&&s.colX[n]+s.colWidth[n]>l);++n);var h=a.nodes[t],d=i.alignColToSeqPos[h],f=d&&d[n],p=c[h],m=p&&p[n];return{row:t,column:n,node:h,seqPos:f,c:m,isGap:this.props.isGapChar(m)}}}]),n}(r.Component),I=n(33),H=n.n(I),N=n(138),W=n(136),P=n(68),V=n.n(P),q=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).pvDivRef=a.a.createRef(),r}return Object(d.a)(n,[{key:"render",value:function(){var e=Object(g.isArray)(this.props.structure.structureInfo),t=!e&&this.props.structure.structureInfo.pdb;return a.a.createElement("div",{className:"MSA-structure",style:{width:this.props.config.width,height:this.props.config.height}},a.a.createElement("div",{className:"MSA-structure-name"},this.props.structure.node),t&&a.a.createElement("div",{className:"MSA-structure-label"},t),a.a.createElement("div",{className:"MSA-structure-top"},e&&a.a.createElement(m.a,{value:"",displayEmpty:!0,onChange:this.handleSelectStructure.bind(this)},a.a.createElement(v.a,{value:"",disabled:!0},"Select a structure"),this.props.structure.structureInfo.map((function(e,t){return a.a.createElement(v.a,{key:t,value:e},e.pdb)}))),a.a.createElement("div",{className:"MSA-structure-close-button"},a.a.createElement(V.a,{onClick:this.handleClose.bind(this)}))),a.a.createElement("div",{className:"MSA-structure-pv",ref:this.pvDivRef}))}},{key:"getPvConfig",value:function(e){var t=e.width,n=e.height;return e.pvConfig||{width:t,height:n,antialias:!0,quality:"medium"}}},{key:"pdbUrlPrefix",value:function(){return"https://files.rcsb.org/download/"}},{key:"pdbUrlSuffix",value:function(){return".pdb"}},{key:"componentDidMount",value:function(){Object(g.isArray)(this.props.structure.structureInfo)||this.loadStructure()}},{key:"componentDidUpdate",value:function(){Object(g.isArray)(this.props.structure.structureInfo)||this.loadStructure()}},{key:"handleSelectStructure",value:function(e){this.props.updateStructure({structureInfo:e.target.value})}},{key:"loadStructure",value:function(){var e=this;if(!this.props.structure.pdbFetchInitiated){this.props.updateStructure({pdbFetchInitiated:!0});var t=this.props.config,n=this.getPvConfig(t),r=H.a.Viewer(this.pvDivRef.current,n),a=!t.noRemoteStructures,i=(a?this.pdbUrlPrefix():t.pdbPrefix||"")+this.props.structure.structureInfo.pdb+(a?this.pdbUrlSuffix():t.pdbSuffix||"");H.a.io.fetchPdb(i,(function(t){e.props.updateStructure({pdb:t,viewer:r}),e.props.setViewType(),r.centerOn(t),r.autoZoom()}))}}},{key:"handleClose",value:function(e){e.preventDefault(),this.props.handleCloseStructure(this.props.structure)}}]),n}(r.Component),U=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={config:r.props.initConfig,viewMode:"cartoon",colorScheme:"ssSuccession"},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this;return this.props.structures.length?a.a.createElement("div",{className:"MSA-structure-panel"},a.a.createElement("div",{className:"MSA-structure-controls"},a.a.createElement(m.a,{value:this.state.viewMode,onChange:this.handleSelectViewType.bind(this)},a.a.createElement(v.a,{value:"cartoon"},"Cartoons"),a.a.createElement(v.a,{value:"tube"},"Tube"),a.a.createElement(v.a,{value:"spheres"},"Spheres"),a.a.createElement(v.a,{value:"ballsAndSticks"},"Balls and sticks")),a.a.createElement(m.a,{value:this.state.colorScheme,onChange:this.handleSelectColorScheme.bind(this)},a.a.createElement(v.a,{value:"uniform"},"Uniform"),a.a.createElement(v.a,{value:"byChain"},"Chain"),a.a.createElement(v.a,{value:"bySS"},"Secondary structure"),a.a.createElement(v.a,{value:"ssSuccession"},"Secondary structure gradient"),a.a.createElement(v.a,{value:"rainbow"},"Rainbow")),a.a.createElement(N.a,{control:a.a.createElement(W.a,{checked:this.state.config.showMouseoverLabel,onChange:this.handleMouseoverLabelConfig.bind(this)}),label:"Show label on mouseover"})),a.a.createElement("div",{className:"MSA-structures"},this.props.structures.map((function(t){return a.a.createElement(q,{key:t.key,structure:t,config:e.state.config,setViewType:function(){return e.setViewType(t)},updateStructure:function(n){return e.props.updateStructure(t,n)},handleCloseStructure:e.props.handleCloseStructure})})))):""}},{key:"handleMouseoverLabelConfig",value:function(e){var t=this.state.config;t.showMouseoverLabel=e.target.checked,this.setState({config:t})}},{key:"mouseoverLabelDelay",value:function(){return 100}},{key:"redrawStructureDelay",value:function(){return 500}},{key:"setViewType",value:function(e,t,n){var r=this;t=t||this.state.viewMode,n=n||this.state.colorScheme;var a=e.pdb,i=e.viewer;if(i){i.clear();var o=i.renderAs("protein",a,t,{color:H.a.color[n]()});this.props.updateStructure(e,{geometry:o})}this.props.structures.forEach((function(e){r.props.updateStructure(e,{trueAtomColor:{}})})),this.requestRedrawStructures()}},{key:"handleSelectViewType",value:function(e){var t=this,n=e.target.value;this.setState({viewMode:n}),this.props.structures.forEach((function(e){return t.setViewType(e,n)}))}},{key:"handleSelectColorScheme",value:function(e){var t=this,n=e.target.value;this.setState({colorScheme:n}),this.props.structures.forEach((function(e){return t.setViewType(e,void 0,n)}))}},{key:"addLabelToStructuresOnMouseover",value:function(e){var t=this;this.setTimer("mouseover",this.mouseoverLabelDelay(),(function(){var n=t.state.config.label||{font:"sans-serif",fontSize:12,fontColor:"#f62",fillStyle:"white",backgroundAlpha:.4},r=t.state.config.atomHighlightColor||"red";t.props.structures.forEach((function(a){if(e.c&&!e.isGap&&a.viewer){var i=t.props.alignIndex.alignColToSeqPos[a.node];if(i){var o=i[e.column]+a.startPos;t.removeMouseoverLabels(a),a.structureInfo.chains.forEach((function(e){if((!e.startPos||o>=e.startPos)&&(!e.endPos||o<=e.endPos)){var i=e.chain,s=a.pdb.residueSelect((function(e){return e.num()===o&&("undefined"===typeof i||e.chain().name()===i)}));s&&s.eachResidue((function(e){var i="mouseover"+(a.mouseoverLabel.length+1);t.state.config.showMouseoverLabel&&a.viewer.label(i,e.qualifiedName(),e.centralAtom().pos(),n),e.atoms().forEach((function(e){if(!a.trueAtomColor[e.index()]){var t=[0,0,0,0];a.geometry.getColorForAtom(e,t),a.trueAtomColor[e.index()]=t}})),t.setColorForAtoms(a.geometry,e.atoms(),r),a.mouseoverLabel.push({label:i,res:e})}))}}))}}})),t.requestRedrawStructures()}))}},{key:"removeLabelFromStructuresOnMouseout",value:function(){var e=this;this.clearTimer("mouseover"),this.props.structures.forEach((function(t){e.removeMouseoverLabels(t)})),this.requestRedrawStructures()}},{key:"removeMouseoverLabels",value:function(e){var t=this;e.mouseoverLabel.forEach((function(n){t.state.config.showMouseoverLabel&&e.viewer.rm(n.label);var r={};n.res.atoms().forEach((function(t){var n=e.trueAtomColor[t.index()],a=n.toString();r[a]=r[a]||{trueColor:n,atoms:[]},r[a].atoms.push(t)})),Object.keys(r).forEach((function(n){return t.setColorForAtoms(e.geometry,r[n].atoms,r[n].trueColor)}))})),e.mouseoverLabel=[]}},{key:"setColorForAtoms",value:function(e,t,n){var r=e.structure().createEmptyView();t.forEach((function(e){return r.addAtom(e)})),e.colorBy(H.a.color.uniform(n),r)}},{key:"requestRedrawStructures",value:function(){var e=this;this.setTimer("redraw",this.redrawStructureDelay(),(function(){e.props.structures.filter((function(e){return e.viewer})).forEach((function(e){return e.viewer.requestRedraw()}))}))}},{key:"setTimer",value:function(e,t,n){var r=this;this.timer=this.timer||{},this.clearTimer(this,e),this.timer[e]=window.setTimeout((function(){delete r.timer[e],n()}),t)}},{key:"clearTimer",value:function(e){this.timer&&this.timer[e]&&(window.clearTimeout(this.timer[e]),delete this.timer[e])}}]),n}(r.Component),z=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;Object(h.a)(this,n),r=t.call(this,e);var i=Object(g.extend)(r.initialView(),e.view||{});return r.state=Object(g.extend)({scrollTop:0,alignScrollLeft:0},{view:i}),r.rowsRef=a.a.createRef(),r.msaRef=a.a.createRef(),r.structRef=a.a.createRef(),r}return Object(d.a)(n,[{key:"initialView",value:function(){return{collapsed:{},forceDisplayNode:{},nodeScale:{},columnScale:{},disableTreeEvents:!1,animating:!1,structure:{openStructures:[]}}}},{key:"collapseAnimationFrames",value:function(){return 10}},{key:"collapseAnimationDuration",value:function(){return 200}},{key:"collapseAnimationMaxFrameSkip",value:function(){return 8}},{key:"resetView",value:function(){this.setState({view:this.initialView()})}},{key:"getComputedView",value:function(e){var t=this;e=e||this.state.view;var n=this.props,r=n.treeIndex,a=n.alignIndex,i=e,o=i.collapsed,s=i.forceDisplayNode,c=a.rowDataAsArray,l={},u={};!function e(t,n){l[t]=l[n]||o[n];var a=r.children[t];a&&a.forEach((function(n){return e(n,t)}))}(r.root),r.nodes.forEach((function(e){return u[e]=!l[e]&&(0===r.children[e].length||s[e])}));var h=new Array(a.columns).fill(!1);return r.nodes.filter((function(e){return u[e]})).forEach((function(e){c[e]&&c[e].forEach((function(e,n){t.props.isGapChar(e)||(h[n]=!0)}))})),Object(g.extend)({ancestorCollapsed:l,nodeVisible:u,columnVisible:h},e)}},{key:"layoutTree",value:function(e){var t=this.props,n=t.computedTreeConfig,r=t.treeIndex,a=e.nodeVisible,i=e.nodeScale,o=n.genericRowHeight,s=n.nodeHandleRadius,c=n.treeStrokeWidth,l=n.availableTreeWidth,u=n.scrollbarHeight,h={},d={},f=[],p={},m=[],v=0,g=r.nodes.map((function(e){var t="undefined"!==typeof i[e]?i[e]:1,n=t*(a[e]?o:0),u=v;return h[e]=s+c+l*r.distFromRoot[e]/r.maxDistFromRoot,d[e]=u+n/2,p[e]=n,f.push(t),m.push(n),v+=n,u}));return{nx:h,ny:d,computedRowScale:f,nodeHeight:p,rowHeight:m,rowY:g,treeHeight:v+=u,computedView:e}}},{key:"layoutAlignment",value:function(e){var t=this,n=this.props,r=n.alignIndex,a=n.computedFontConfig,i=a.genericRowHeight,o=a.charFont,s=r.chars,c=0,l={};s.forEach((function(e){var n=t.create("canvas",null,null,{width:i,height:i}).getContext("2d");n.font=o,l[e]=n.measureText(e),c=Math.max(c,Math.ceil(l[e].width))}));for(var u=i,h=0,d=[],f=[],p=[],m=0;m<r.columns;++m)if(d.push(h),e.columnVisible[m]){var v=e.columnScale[m];"undefined"===typeof v&&(v=1),p.push(v);var g=v*c;f.push(g),h+=g}else p.push(0),f.push(0);return{charMetrics:l,charWidth:c,charHeight:u,colX:d,colWidth:f,computedColScale:p,alignWidth:h}}},{key:"create",value:function(e,t,n,r){var a=document.createElement(e);return t&&t.appendChild(a),r&&Object.keys(r).filter((function(e){return"undefined"!==typeof r[e]})).forEach((function(e){return a.setAttribute(e,r[e])})),n&&(a.style=n),a}},{key:"render",value:function(){var e=this,t=this.getComputedView(),n=this.layoutTree(t),r=this.layoutAlignment(t);return this.treeHeight=n.treeHeight,this.alignWidth=r.alignWidth,a.a.createElement("div",{className:"MSA",style:{width:this.props.config.containerWidth,height:this.props.config.containerHeight}},a.a.createElement("div",{className:"MSA-tree-alignment",ref:this.msaRef,onMouseDown:this.handleMouseDown.bind(this),onMouseLeave:function(){return e.structRef.current.removeLabelFromStructuresOnMouseout()},style:{width:this.props.config.containerWidth,height:n.treeAlignHeight}},a.a.createElement(O,{config:this.props.config,computedTreeConfig:this.props.computedTreeConfig,treeIndex:this.props.treeIndex,treeLayout:n,computedView:t,scrollTop:this.state.scrollTop,handleNodeClick:this.handleNodeClick.bind(this)}),a.a.createElement(T,{data:this.props.data,view:this.state.view,config:this.props.config,computedFontConfig:this.props.computedFontConfig,treeIndex:this.props.treeIndex,alignIndex:this.props.alignIndex,treeLayout:n,alignLayout:r,computedView:t,scrollTop:this.state.scrollTop,handleNameClick:this.handleNameClick.bind(this)}),a.a.createElement(F,{ref:this.rowsRef,data:this.props.data,view:this.state.view,config:this.props.config,computedFontConfig:this.props.computedFontConfig,treeIndex:this.props.treeIndex,alignIndex:this.props.alignIndex,isGapChar:this.props.isGapChar,treeLayout:n,alignLayout:r,setClientSize:this.setAlignmentClientSize.bind(this),handleScroll:this.handleAlignmentScroll.bind(this),handleMouseDown:this.handleAlignmentMouseDown.bind(this),handleAlignCharClick:this.handleAlignCharClick.bind(this),handleAlignCharMouseOver:this.handleAlignCharMouseOver.bind(this),handleAlignCharMouseOut:this.handleAlignCharMouseOut.bind(this),scrollLeft:this.state.alignScrollLeft,scrollTop:this.state.scrollTop})),a.a.createElement(U,{ref:this.structRef,initConfig:this.props.config.structure,alignIndex:this.props.alignIndex,structures:this.state.view.structure.openStructures,updateStructure:this.updateStructure.bind(this),handleCloseStructure:this.handleCloseStructure.bind(this)}))}},{key:"componentDidMount",value:function(){window.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),window.addEventListener("mouseup",this.handleMouseUp.bind(this)),window.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.msaRef.current.addEventListener("wheel",this.handleMouseWheel.bind(this),{passive:!1})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mouseleave",this.handleMouseLeave.bind(this)),window.removeEventListener("mouseup",this.handleMouseUp.bind(this)),window.removeEventListener("mousemove",this.handleMouseMove.bind(this)),this.msaRef.current.removeEventListener("wheel",this.handleMouseWheel.bind(this))}},{key:"setAlignmentClientSize",value:function(e,t){this.alignmentClientWidth=e,this.alignmentClientHeight=t}},{key:"handleNameClick",value:function(e){var t=this.props.data.structure;this.nStructs=(this.nStructs||0)+1;var n={node:e,structureInfo:t[e],startPos:this.props.data.seqCoords[e].startPos,mouseoverLabel:[],trueAtomColor:{},key:this.nStructs},r=this.state.view;r.structure.openStructures.push(n),this.setState({view:r})}},{key:"updateStructure",value:function(e,t){var n=this.state.view;n.structure.openStructures=n.structure.openStructures.map((function(n){return n===e?Object(g.extend)(n,t):n})),this.setState({view:n})}},{key:"handleCloseStructure",value:function(e){var t=this.state.view;t.structure.openStructures=t.structure.openStructures.filter((function(t){return t!==e})),this.setState({view:t})}},{key:"handleNodeClick",value:function(e){var t=this;if(this.scrolling)this.scrolling=!1;else if(!this.state.disableTreeEvents){var n=this.props,r=n.treeIndex,a=n.alignIndex,i=this.getComputedView(),o=i.collapsed,s=i.nodeScale,c=i.columnScale,l=i.forceDisplayNode,u=i.columnVisible,h=this.layoutAlignment(i),d=this.state.alignScrollLeft,f=d+this.alignmentClientWidth,p=this.collapseAnimationFrames(),m=p,v=o[e],w=Object(g.extend)({},o);v?(o[e]=!1,delete w[e]):w[e]=!0;var b=Object(g.extend)({},l);b[e]=!v;for(var y=this.getComputedView({collapsed:w,forceDisplayNode:b}),k=[],S=[],C=[],D=0;D<a.columns;++D){y.columnVisible[D]!==u[D]&&(y.columnVisible[e]?k:S).push(D);var E=h.colX[D],x=h.colWidth[D];u[D]&&y.columnVisible[D]&&E>=d&&E+x<f&&C.push(D)}var R=this.centroidOfColumns(C,h)-this.state.alignScrollLeft,M=Date.now(),A=this.collapseAnimationDuration()/p;!function n(){var a,i,u=o;if(m){var h=(v?p+1-m:m)/(p+1);r.descendants[e].forEach((function(e){s[e]=h})),s[e]=1-h,S.forEach((function(e){return c[e]=h})),k.forEach((function(e){return c[e]=1-h})),l[e]=!0,a=!0,i=!0}else r.descendants[e].forEach((function(e){delete s[e]})),delete s[e],S.forEach((function(e){return delete c[e]})),k.forEach((function(e){return delete c[e]})),l[e]=!v,u=w,a=!1,i=!1;var d=Object(g.extend)({},t.state.view,{collapsed:u,forceDisplayNode:l,nodeScale:s,columnScale:c,disableTreeEvents:a,animating:i}),f=t.getComputedView(d),b=t.layoutAlignment(f),y=t.boundAlignScrollLeft(t.centroidOfColumns(C,b)-R);window.requestAnimationFrame((function(){if(t.setState({alignScrollLeft:y,view:d}),m){var e=Date.now(),r=e-M,a=Math.max(0,A-r),i=Math.min(t.collapseAnimationMaxFrameSkip(),Math.ceil(r/A));m=Math.max(0,m-i),M=e,setTimeout(n,a)}}))}()}}},{key:"handleAlignmentScroll",value:function(e,t){e===this.state.alignScrollLeft&&t===this.state.scrollTop||this.setState({alignScrollLeft:e,scrollTop:t})}},{key:"handleMouseWheel",value:function(e){var t=this;if(0!==e.deltaY){var n=e.deltaY*(e.deltaMode?this.props.config.genericRowHeight:1);e.preventDefault(),this.requestAnimationFrame((function(){t.setState({alignScrollLeft:t.incAlignScrollLeft(e.deltaX),scrollTop:t.incScrollTop(n)})}))}}},{key:"handleMouseDown",value:function(e){this.mouseDown=!0,this.lastY=e.pageY}},{key:"handleAlignmentMouseDown",value:function(e){this.alignMouseDown=!0,this.lastX=e.pageX}},{key:"handleAlignCharClick",value:function(e){!this.panning&&this.scrolling,this.panning=this.scrolling=!1}},{key:"handleAlignCharMouseOver",value:function(e){this.panning||this.scrolling||this.structRef.current.addLabelToStructuresOnMouseover(e)}},{key:"handleAlignCharMouseOut",value:function(e){this.panning||this.scrolling||this.structRef.current.removeLabelFromStructuresOnMouseout()}},{key:"handleMouseLeave",value:function(){this.alignMouseDown=!1,this.mouseDown=!1,this.panning=this.scrolling=!1}},{key:"handleMouseUp",value:function(){this.alignMouseDown=!1,this.mouseDown=!1}},{key:"centroidOfColumns",value:function(e,t){return e.reduce((function(e,n){return e+t.colX[n]+t.colWidth[n]/2}),0)/e.length}},{key:"incAlignScrollLeft",value:function(e){return this.boundAlignScrollLeft(this.state.alignScrollLeft+e)}},{key:"incScrollTop",value:function(e){return this.boundScrollTop(this.state.scrollTop+e)}},{key:"boundAlignScrollLeft",value:function(e){return Math.max(0,Math.min(this.alignWidth-this.alignmentClientWidth,e))}},{key:"boundScrollTop",value:function(e){return Math.max(0,Math.min(this.treeHeight-this.alignmentClientHeight,e))}},{key:"handleMouseMove",value:function(e){var t=this;(this.alignMouseDown||this.mousedown)&&e.preventDefault();var n=this.state,r=n.alignScrollLeft,a=n.scrollTop,i=!1;if(this.alignMouseDown){var o=e.pageX-this.lastX;o&&(r=this.incAlignScrollLeft(-o),this.panning=!0,i=!0)}else this.panning=!1;if(this.mouseDown){var s=e.pageY-this.lastY;s&&(a=this.incScrollTop(-s),this.scrolling=!0,i=!0)}else this.scrolling=!1;i&&this.requestAnimationFrame((function(){t.setState({alignScrollLeft:r,scrollTop:a}),t.lastX=e.pageX,t.lastY=e.pageY}))}},{key:"requestAnimationFrame",value:function(e){this.animationTimeout&&window.cancelAnimationFrame(this.animationTimeout),this.animationTimeout=window.requestAnimationFrame(e)}},{key:"setTimer",value:function(e,t,n){var r=this;this.timer=this.timer||{},this.clearTimer(this,e),this.timer[e]=window.setTimeout((function(){delete r.timer[e],n()}),t)}},{key:"clearTimer",value:function(e){this.timer&&this.timer[e]&&(window.clearTimeout(this.timer[e]),delete this.timer[e])}}]),n}(r.Component),G=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;Object(h.a)(this,n),r=t.call(this,e);var i=Object(g.extend)(r.defaultConfig(),e.config||{}),o=i.genericRowHeight,s=i.nameFontSize,c=i.treeWidth,l=i.branchStrokeStyle,u=i.nodeHandleRadius,d={treeWidth:c,availableTreeWidth:c-u-2,genericRowHeight:o,branchStrokeStyle:l,nodeHandleStrokeStyle:l,nodeHandleRadius:u,nodeHandleClickRadius:i.nodeHandleClickRadius,nodeHandleFillStyle:i.nodeHandleFillStyle,collapsedNodeHandleFillStyle:i.collapsedNodeHandleFillStyle,rowConnectorDash:i.rowConnectorDash,treeStrokeWidth:1,scrollbarHeight:20},f={charFont:o+"px Menlo,monospace",charFontName:"Menlo,monospace",color:i.color||w[i.colorScheme],nameFontName:"inherit",nameFontSize:s,nameFontColor:"black",genericRowHeight:o};return r.state={config:i,datasets:r.props.datasets||[],computedTreeConfig:d,computedFontConfig:f},r.divRef=a.a.createRef(),r.inputRef=a.a.createRef(),r.msaRef=a.a.createRef(),r}return Object(d.a)(n,[{key:"handleDragEnter",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"handleDragOver",value:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}},{key:"handleDrop",value:function(e){e.stopPropagation(),e.preventDefault(),this.openFiles(e.dataTransfer.files)}},{key:"handleSelectDataset",value:function(e){var t=e.target.value;t?(this.setDataset(this.state.datasets.find((function(e){return e.name===t}))),this.msaRef.current.resetView()):this.inputRef.current.click()}},{key:"handleSelectFile",value:function(e){this.openFiles(e.target.files)}},{key:"openFiles",value:function(e){var t=this;return Promise.all(Array.from(e).map((function(e){return t.openFile(e)})))}},{key:"openFile",value:function(e){var t=this;return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var r=e.target.result;t.addDatasets(r),n()},a.readAsText(e)}))}},{key:"addDatasets",value:function(e){var t=this,n=function(e){return"Alignment "+(t.state.datasets.length+(e||0)+1)},r=this.state.datasets;if(this.sniffStockholmRegex.test(e)){var a=E.a.parseAll(e);r=r.concat(a.map((function(e,t){return{stockholmjs:e,name:e.gf.ID?e.gf.ID[0]:n(t)}})))}else try{var i=JSON.parse(e);Object(g.isArray)(i)?r=r.concat(i):r.push(i)}catch(s){r.push({auto:e,name:n()})}if(r.length>this.state.datasets.length){var o=r[this.state.datasets.length];this.setDataset(o,{datasets:r}),this.msaRef.current&&this.msaRef.current.resetView()}}},{key:"setDataset",value:function(e,t){var n=this,r=this.datasetsLoaded=(this.datasetsLoaded||0)+1;this.indexData(e).then((function(e){return n.setState(Object(g.extend)({datasetID:r,reconstructingAncestors:!1},e,t||{}))}))}},{key:"indexData",value:function(){var e=Object(u.a)(l.a.mark((function e(t,n){var r,a,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||this.state.config,e.next=3,this.getData(r.cacheData?t:Object(g.extend)({},t),r);case 3:return a=e.sent,i=this.buildTreeIndex(a),o=this.buildAlignmentIndex(a),e.abrupt("return",{data:a,treeIndex:i,alignIndex:o});case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getData",value:function(){var e=Object(u.a)(l.a.mark((function e(t,n){var r,a,i,o,s,c,h,d,f,p,m,v=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.url){e.next=3;break}return e.next=3,Promise.all(Object.keys(t.url).filter((function(e){return!t[e]})).map((function(e){var n=v.makeURL(t.url[e]);return fetch(n).then(function(){var r=Object(u.a)(l.a.mark((function r(a){return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!a.ok){r.next=6;break}return r.next=3,a.text();case 3:t[e]=r.sent,r.next=7;break;case 6:console.warn("Error fetching "+n,a.statusText);case 7:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())})));case 3:if(t.json&&Object(g.extend)(t,"string"===typeof t.json?JSON.parse(t.json):t.json),t.auto)if(this.sniffStockholmRegex.test(t.auto))t.stockholm=t.auto;else if(this.sniffFastaRegex.test(t.auto))t.fasta=t.auto;else try{Object(g.extend)(t,JSON.parse(t.auto))}catch(w){}if(t.branches&&t.rowData){e.next=20;break}if(!t.stockholm){e.next=10;break}this.unpackStockholm(t,n,t.stockholm),e.next=19;break;case 10:if(!t.stockholmjs){e.next=14;break}this.unpackStockholmJS(t,n,t.stockholmjs),e.next=19;break;case 14:if(!t.fasta){e.next=18;break}t.rowData=this.parseFasta(t.fasta),e.next=19;break;case 18:throw new Error("no sequence data");case 19:t.newick||t.newickjs?(r=new x.Newick,a=t.newickjs=t.newickjs||r.parse(t.newick),i=0,o=function(e){return e.name=e.name||"node"+ ++i},t.branches=[],function e(n){n.branchset&&n.branchset.forEach((function(r){t.branches.push([o(n),o(r),Math.max(r.length,0)]),e(r)}))}(a),t.root=o(a)):(s=Object.keys(t.rowData).sort(),c=s.map((function(e){return t.rowData[e]})),console.warn("Estimating phylogenetic tree ("+s.length+" taxa)..."),h=M.a.calcFiniteDistanceMatrix(c),(d=new L.a.RapidNeighborJoining(h,s.map((function(e){return{name:e}})))).run(),f=d.getAsObject(),p=0,m=function(e){return e.taxon=e.taxon||{name:"node"+ ++p},e.taxon.name},t.branches=[],function e(n){n.children.forEach((function(r){t.branches.push([m(n),m(r),Math.max(r.length,0)]),e(r)}))}(f),t.root=m(f));case 20:return this.guessSeqCoords(t),e.abrupt("return",t);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"guessSeqCoords",value:function(e){var t=this;e.seqCoords||(e.seqCoords={}),Object.keys(e.rowData).forEach((function(n){var r=e.rowData[n],a=t.countNonGapChars(r);if(!e.seqCoords[n]){var i=t.nameEncodedCoordRegex.exec(n);if(i){var o=parseInt(i[1]),s=parseInt(i[2]);s+1-o===a&&(e.seqCoords[n]={startPos:o,endPos:s})}}e.seqCoords[n]||(e.seqCoords[n]={startPos:1,endPos:a})}))}},{key:"makeURL",value:function(e){return e.replace("%PUBLIC_URL%","")}},{key:"unpackStockholm",value:function(e,t,n){var r=E.a.parse(n);this.unpackStockholmJS(e,t,r)}},{key:"unpackStockholmJS",value:function(e,t,n){var r=this,a=e.structure=e.structure||{};e.rowData=n.seqdata,this.guessSeqCoords(e),n.gf.DE&&(e.description=n.gf.DE.join("\n")),n.gf.NH&&!e.newick&&(e.newick=n.gf.NH.join("")),n.gs.DR&&!t.structure.noRemoteStructures&&Object.keys(n.gs.DR).forEach((function(t){var i=e.seqCoords[t];n.gs.DR[t].forEach((function(e){var n=r.pdbRegex.exec(e);if(n){var o=n[1].toLowerCase(),s=n[2],c=parseInt(n[3]),l=parseInt(n[4]);c<=i.endPos&&l>=i.startPos?(a[t]=a[t]||{pdb:o,chains:[]},a[t].chains.push({chain:s,startPos:c,endPos:l})):console.warn("ignoring structure "+o+" ("+c+"..."+l+") since it does not overlap with "+t)}}))}))}},{key:"componentDidMount",value:function(){this.divRef.current.addEventListener("dragover",this.handleDragOver.bind(this),!1),this.divRef.current.addEventListener("dragenter",this.handleDragEnter.bind(this),!1),this.divRef.current.addEventListener("drop",this.handleDrop.bind(this),!1),this.initDataset()}},{key:"componentWillUnmount",value:function(){this.divRef.current.removeEventListener("dragover",this.handleDragOver.bind(this),!1),this.divRef.current.removeEventListener("dragenter",this.handleDragEnter.bind(this),!1),this.divRef.current.removeEventListener("drop",this.handleDrop.bind(this))}},{key:"componentDidUpdate",value:function(){this.reconstructMissingNodes()}},{key:"initDataset",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.stockholm&&this.addDatasets(this.props.stockholm),!this.props.dataurl){e.next=4;break}return e.next=4,fetch(this.makeURL(this.props.dataurl)).then(function(){var e=Object(u.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.ok){e.next=6;break}return e.t0=t,e.next=4,n.text();case 4:e.t1=e.sent,e.t0.addDatasets.call(e.t0,e.t1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:this.setDataset(this.props.data||this.state.datasets[0]);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reconstructMissingNodes",value:function(){var e,t=this,n=this.state.data;if(n){var r=n.branches,a=Object(g.extend)({},n.rowData);if(n.branches.filter((function(e){return"undefined"===typeof a[e[0]]})).length&&!this.state.reconstructingAncestors)if(this.setState({reconstructingAncestors:!0}),window.Worker)console.warn("Reconstructing ancestral sequences in web worker..."),e=C()().getAncestralReconstruction({branches:r,rowData:a,id:this.state.datasetID}).then((function(e){console.warn("Ancestral sequence reconstruction complete"),e.id===t.state.datasetID?t.incorporateAncestralReconstruction(e.ancestralRowData):console.warn("Discarding unused ancestral sequence reconstruction")}));else console.warn("Reconstructing ancestral sequences..."),e=k({branches:r,rowData:a}).then((function(e){t.incorporateAncestralReconstruction(e.ancestralRowData)}))}else e=Promise.resolve();return e}},{key:"fn2workerURL",value:function(e){var t=new Blob(["("+e.toString()+")()"],{type:"application/javascript"});return URL.createObjectURL(t)}},{key:"incorporateAncestralReconstruction",value:function(e){var t=this.state.data,n=Object(g.extend)({},t.rowData,e);Object(g.extend)(t,{rowData:n}),this.setState({data:t,reconstructingAncestors:!1})}},{key:"defaultColorScheme",value:function(){return"maeditor"}},{key:"defaultConfig",value:function(){return{treeAlignHeight:400,genericRowHeight:24,nameFontSize:12,containerHeight:"100%",containerWidth:"100%",treeWidth:200,nameDivWidth:200,branchStrokeStyle:"black",nodeHandleRadius:4,nodeHandleClickRadius:40,nodeHandleFillStyle:"white",collapsedNodeHandleFillStyle:"black",rowConnectorDash:[2,2],structure:{width:400,height:400},handler:{},colorScheme:this.defaultColorScheme()}}},{key:"parseFasta",value:function(e){var t,n={},r=/^>(\S+)/;return e.split("\n").forEach((function(e){var a=r.exec(e);a?n[t=a[1]]="":t&&(n[t]=n[t]+e.replace(/[ \t]/g,""))})),n}},{key:"buildTreeIndex",value:function(e){var t=e.branches,n=e.root,r="undefined"!==typeof n,a=this.getRoots(t);if(0===a.length&&(t.length>0||!r))throw new Error("No root nodes");if(r){if(a.indexOf(n)<0)throw new Error("Specified root node is not a root")}else{if(1!==a.length)throw new Error("Multiple possible root nodes, and no root specified");n=a[0]}var i={},o={};i[n]=[],o[n]=0,t.forEach((function(e){var t=e[0],n=e[1],r=e[2];i[t]=i[t]||[],i[n]=i[n]||[],i[t].push(n),o[n]=r}));var s=[],c={},l={},u={},h=0,d=function(e){if(!e)throw new Error("All nodes must be named");if(c[e])throw new Error("All node names must be unique (duplicate '"+e+"')");c[e]=!0,s.push(e)};return function e(t,n){u[t]=("undefined"!==typeof n?u[n]:0)+o[t],h=Math.max(h,u[t]);var r=i[t],a=[];return 2===r.length?(a=a.concat(e(r[0],t)),d(t),a=a.concat(e(r[1],t))):(d(t),r.forEach((function(n){return a=a.concat(e(n,t))}))),l[t]=a,[t].concat(a)}(n),{root:n,branches:t,children:i,descendants:l,branchLength:o,nodes:s,distFromRoot:u,maxDistFromRoot:h}}},{key:"getRoots",value:function(e){var t={},n={};return e.forEach((function(e){var r=Object(s.a)(e,2),a=r[0],i=r[1];t[a]=t[i]=n[i]=!0})),Object.keys(t).filter((function(e){return!n[e]})).sort()}},{key:"buildAlignmentIndex",value:function(e){var t,n=this,r=e.rowData,a={},i={},o={},s={};Object.keys(r).forEach((function(e){var c=r[e];"undefined"!==typeof t&&t!==c.length&&console.error("Inconsistent row lengths"),t=c.length;var l=[],u=0,h="string"===typeof c?c.split(""):c;i[e]=h.map((function(e,t){"string"===typeof e&&(s[e]=!0);var r=n.isGapChar(e);return r||l.push(t),r?u:u++})),a[e]=h,o[e]=l}));var c=Object.keys(s).sort();return{alignColToSeqPos:i,rowDataAsArray:a,columns:t,chars:c}}},{key:"isGapChar",value:function(e){return"string"===typeof e?"-"===e||"."===e:!e||0===Object.keys(e).length}},{key:"countNonGapChars",value:function(e){var t=this;return e.split("").filter((function(e){return!t.isGapChar(e)})).length}},{key:"render",value:function(){return a.a.createElement("div",{className:"App",ref:this.divRef},a.a.createElement("div",{className:"MSA-appbar"},a.a.createElement("input",{type:"file",ref:this.inputRef,onChange:this.handleSelectFile.bind(this),style:{display:"none"}}),this.state.data?this.state.datasets.length?a.a.createElement(m.a,{value:this.state.data.name,onChange:this.handleSelectDataset.bind(this)},this.state.datasets.map((function(e){return a.a.createElement(v.a,{key:e.name,value:e.name},e.name)})),a.a.createElement(v.a,{value:""},a.a.createElement("i",null,"Open alignment file"))):a.a.createElement("div",{className:"MSA-appbar-title"},this.state.data.name):"",this.state.data&&this.state.data.description?a.a.createElement("div",{className:"MSA-appbar-description"},this.state.data.description):""),this.state.data&&a.a.createElement(z,{ref:this.msaRef,data:this.state.data,isGapChar:this.isGapChar.bind(this),config:this.state.config,view:this.state.view,treeIndex:this.state.treeIndex,alignIndex:this.state.alignIndex,computedTreeConfig:this.state.computedTreeConfig,computedFontConfig:this.state.computedFontConfig}))}},{key:"pdbRegex",get:function(){return/PDB; +(\S+) +(\S); ([0-9]+)-([0-9]+)/}},{key:"nameEncodedCoordRegex",get:function(){return/\/([0-9]+)-([0-9]+)$/}},{key:"sniffStockholmRegex",get:function(){return/^# STOCKHOLM/}},{key:"sniffFastaRegex",get:function(){return/^>/}}]),n}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Y={dataurl:"%PUBLIC_URL%/pfam-cov2.stock",config:{containerHeight:"1000px",handler:{click:function(e){console.warn("Click "+e.node+" column "+e.column+(e.isGap?"":", position "+e.seqPos)+" ("+e.c+")")}}}};o.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(G,Y)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},60:function(e,t,n){var r=n(91),a=["getAncestralReconstruction"];e.exports=function(){var e=new Worker(n.p+"1b67139851fbce868382.worker.js",{name:"[hash].worker.js"});return r(e,a),e}},74:function(e,t,n){e.exports=n(104)},79:function(e,t,n){},82:function(e,t,n){}},[[74,1,2]]]);
//# sourceMappingURL=main.08c47107.chunk.js.map