{"version":3,"sources":["colorSchemes.js","reconstruction.js","MSATree.js","MSAAlignNames.js","MSAAlignCanvas.js","MSAAlignRows.js","MSAStruct.js","MSAStructPanel.js","MSA.js","App.js","serviceWorker.js","index.js","webpack:///./src/reconstruction.js?60c3"],"names":["clustal","G","P","S","T","H","K","R","F","W","Y","I","L","M","V","lesk","A","C","N","Q","D","E","maeditor","cinema","B","Z","X","getAncestralReconstruction","data","a","branches","rowData","id","gapChar","ancestralRowData","maxEntropy","Math","log","model","PhylogeneticLikelihood","models","makeGappedModel","defaultModel","deletionRate","getNodePostProfiles","branchList","nodeSeq","postProbThreshold","defaultGapChar","nodeProfile","Object","keys","forEach","node","map","charProb","chars","filter","c","sort","b","norm","reduce","psum","probs","entropy","s","p","n","MSATree","props","canvasRef","React","createRef","treeWidth","this","computedTreeConfig","treeHeight","treeLayout","className","style","minWidth","ref","width","height","top","scrollTop","renderTree","current","addEventListener","handleClick","bind","removeEventListener","treeIndex","computedView","collapsed","ancestorCollapsed","forceDisplayNode","nodeScale","branchStrokeStyle","treeStrokeWidth","rowConnectorDash","nodeHandleRadius","nodeHandleFillStyle","collapsedNodeHandleFillStyle","nx","ny","treeCanvas","ctx","getContext","setTransform","globalAlpha","clearRect","strokeStyle","fillStyle","lineWidth","setAlpha","scale","nodesWithHandles","nodes","children","length","setLineDash","beginPath","fillRect","child","moveTo","lineTo","stroke","arc","PI","makeNodeHandlePath","fill","evt","preventDefault","closestNode","closestNodeDistSquared","mouseX","parseInt","offsetX","mouseY","offsetY","distSquared","pow","config","nodeHandleClickRadius","handleNodeClick","Component","MSAAlignNames","computedFontConfig","structure","nameDivWidth","nameFontName","nameFontSize","nodeHeight","fontFamily","fontSize","maxWidth","nodeVisible","row","view","transform","opacity","key","onClick","handleNameClick","MSAAlignCanvas","state","clientWidth","clientHeight","getDimensions","left","color","toUpperCase","scrollLeft","offscreenRatio","getOffscreenRatio","offscreenWidth","offscreenHeight","max","bottom","min","right","alignLayout","alignWidth","setState","renderVisibleRegion","firstRow","lastRow","alignCanvas","alignIndex","font","charFont","rowHeight","rowY","col","xScale","computedColScale","colX","colWidth","yScale","computedRowScale","seq","getColor","fillText","cp","ci","columns","MSAAlignRows","rowsDivRef","alignCanvasRef","onMouseMove","handleMouseMove","onMouseLeave","handleMouseLeave","onMouseDown","handleMouseDown","onScroll","handleScroll","hoverColumn","setScrollPos","setClientSize","window","opts","handleAlignCharClick","resolveAlignCoords","coords","lastCoords","column","handleAlignCharMouseOut","handleAlignCharMouseOver","x","nativeEvent","y","colToSeqPos","alignColToSeqPos","seqPos","isGap","isGapChar","MSAStruct","pvDivRef","wantStructure","isArray","structureInfo","structureID","pdb","Select","value","displayEmpty","onChange","handleSelectStructure","MenuItem","disabled","info","handleClose","structureConfig","pvConfig","antialias","quality","updatePv","loadStructure","updateStructure","target","pdbFetchInitiated","getPvConfig","viewer","pv","Viewer","loadFromPDB","noRemoteStructures","pdbFilePath","pdbUrlPrefix","pdbPrefix","pdbUrlSuffix","pdbSuffix","io","fetchPdb","setViewType","centerOn","autoZoom","rect","boundingClientRect","picked","pick","clientX","clientY","residue","num","chain","name","handleMouseoverResidue","handleCloseStructure","MSAStructPanel","initConfig","viewMode","colorScheme","structures","handleSelectViewType","handleSelectColorScheme","FormControlLabel","control","Checkbox","checked","showMouseoverLabel","handleMouseoverLabelConfig","label","pdbSeqPos","event","clear","geometry","renderAs","trueAtomColor","requestRedrawStructures","undefined","labelConfig","fontColor","backgroundAlpha","atomHighlightColor","removeMouseoverLabels","chains","chainInfo","startPos","endPos","pdbChain","residues","residueSelect","res","eachResidue","mouseoverLabel","qualifiedName","centralAtom","pos","atoms","atom","index","atomColor","getColorForAtom","setColorForAtoms","push","labelInfo","rm","byColor","trueColor","colorString","toString","go","createEmptyView","addAtom","colorBy","uniform","setTimer","redrawStructureDelay","requestRedraw","MSA","extend","initialView","alignScrollLeft","rowsRef","msaRef","structRef","columnScale","disableTreeEvents","animating","openStructures","rowDataAsArray","setCollapsedState","parent","kids","root","columnVisible","Array","genericRowHeight","availableTreeWidth","scrollbarHeight","rh","distFromRoot","maxDistFromRoot","alignChars","charWidth","charMetrics","measureContext","create","measureText","ceil","charHeight","nextColX","type","styles","attrs","element","document","createElement","appendChild","attr","setAttribute","getComputedView","layoutTree","layoutAlignment","containerWidth","containerHeight","treeAlignHeight","setAlignmentClientSize","handleAlignmentScroll","handleAlignmentMouseDown","delayedSetHoverColumn","handleMouseoverStructureResidue","handleMouseUp","handleMouseWheel","passive","w","h","alignmentClientWidth","alignmentClientHeight","nStructs","newStructure","seqCoords","scrolling","collapseAnimationFrames","framesLeft","wasCollapsed","finalCollapsed","finalForceDisplayNode","finalComputedView","newlyVisibleColumns","newlyHiddenColumns","persistingVisibleColumns","centroidMinusScroll","centroidOfColumns","lastFrameTime","Date","now","expectedTimeBetweenFrames","collapseAnimationDuration","drawAnimationFrame","newCollapsed","descendants","desc","boundAlignScrollLeft","requestAnimationFrame","currentTime","timeSinceLastFrame","timeToNextFrame","frameSkip","collapseAnimationMaxFrameSkip","setTimeout","deltaY","deltaMode","incAlignScrollLeft","deltaX","incScrollTop","mouseDown","lastY","pageY","alignMouseDown","lastX","pageX","panning","setMouseoverTimer","setHoverColumn","callback","mouseoverLabelDelay","removeLabelFromStructuresOnMouseout","addLabelToStructuresOnMouseover","seqPosToCol","seqPosToAlignCol","find","cols","sum","dx","dy","boundScrollTop","mousedown","updated","animationTimeout","cancelAnimationFrame","delay","timer","clearTimer","clearTimeout","App","defaultConfig","nodeHandleStrokeStyle","charFontName","colorSchemes","nameFontColor","datasets","divRef","inputRef","stopPropagation","dataTransfer","dropEffect","openFiles","files","setDataset","ds","resetView","click","Promise","all","from","file","openFile","resolve","reject","reader","FileReader","onload","e","text","result","addDatasets","readAsText","autoselect","newAlignmentName","sniffStockholmRegex","test","stocks","Stockholm","parseAll","concat","stockholmjs","gf","ID","json","JSON","parse","auto","firstDataset","extra","datasetID","datasetsLoaded","indexData","then","dataWithIndices","reconstructingAncestors","suppliedData","suppliedConfig","getData","cacheData","buildTreeIndex","buildAlignmentIndex","url","makeURL","fetch","ok","console","warn","statusText","stockholm","sniffFastaRegex","fasta","unpackStockholm","unpackStockholmJS","parseFasta","Error","newick","newickjs","NewickParser","Newick","newickTree","getName","obj","traverse","branchset","taxa","seqs","taxon","distMatrix","JukesCantor","calcFiniteDistanceMatrix","rnj","RapidNeighborJoining","run","tree","getAsObject","guessSeqCoords","len","countNonGapChars","coordMatch","nameEncodedCoordRegex","exec","replace","process","stockjs","stock","seqdata","DE","description","join","NH","gs","DR","seqLen","dr","match","pdbRegex","toLowerCase","pdbLen","pdbStruct","pdbIndex","findIndex","handleDragOver","handleDragEnter","handleDrop","initDataset","reconstructMissingNodes","dataurl","promise","Worker","getAncestralReconstructionWorker","incorporateAncestralReconstruction","fn","blob","Blob","URL","createObjectURL","handler","defaultColorScheme","re","split","line","rootSpecified","roots","getRoots","indexOf","branchLength","branch","seenNode","addNode","addSubtree","clade","isNode","hasParent","isChar","error","pos2col","rowAsArray","handleSelectFile","display","handleSelectDataset","Boolean","location","hostname","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","message","addMethods","methods","module","exports"],"mappings":"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","file":"static/js/main.d196a5f4.chunk.js","sourcesContent":["export default {\n  clustal: {\n    G: 'orange',\n    P: 'orange',\n    S: 'orange',\n    T: 'orange',\n    H: 'red',\n    K: 'red',\n    R: 'red',\n    F: 'blue',\n    W: 'blue',\n    Y: 'blue',\n    I: 'green',\n    L: 'green',\n    M: 'green',\n    V: 'green',\n  },\n  lesk: {\n    G: 'orange',\n    A: 'orange',\n    S: 'orange',\n    T: 'orange',\n    C: 'green',\n    V: 'green',\n    I: 'green',\n    L: 'green',\n    P: 'green',\n    F: 'green',\n    Y: 'green',\n    M: 'green',\n    W: 'green',\n    N: 'magenta',\n    Q: 'magenta',\n    H: 'magenta',\n    D: 'red',\n    E: 'red',\n    K: 'blue',\n    R: 'blue',\n  },\n  maeditor: {\n    A: 'lightgreen',\n    G: 'lightgreen',\n    C: 'green',\n    D: 'darkgreen',\n    E: 'darkgreen',\n    N: 'darkgreen',\n    Q: 'darkgreen',\n    I: 'blue',\n    L: 'blue',\n    M: 'blue',\n    V: 'blue',\n    F: '#c8a2c8',  // lilac\n    W: '#c8a2c8',  // lilac\n    Y: '#c8a2c8',  // lilac\n    H: 'darkblue',\n    K: 'orange',\n    R: 'orange',\n    P: 'pink',\n    S: 'red',\n    T: 'red',\n  },\n  cinema: {\n    H: 'blue',\n    K: 'blue',\n    R: 'blue',\n    D: 'red',\n    E: 'red',\n    S: 'green',\n    T: 'green',\n    N: 'green',\n    Q: 'green',\n    A: 'white',\n    V: 'white',\n    L: 'white',\n    I: 'white',\n    M: 'white',\n    F: 'magenta',\n    W: 'magenta',\n    Y: 'magenta',\n    P: 'brown',\n    G: 'brown',\n    C: 'yellow',\n    B: 'gray',\n    Z: 'gray',\n    X: 'gray',\n    '-': 'gray',\n    '.': 'gray',\n  },\n}\n","import PhylogeneticLikelihood from 'phylogenetic-likelihood';\n\nexport const getAncestralReconstruction = async (data) => {\n  const { branches, rowData, id } = data\n  let { gapChar } = data\n  gapChar = gapChar || '-'\n  let ancestralRowData = {}\n  const alphSize = 20  // assume for ancestral reconstruction purposes these are protein sequences; if not we'll need to pass a different model into getNodePostProfiles\n  const maxEntropy = Math.log(alphSize) / Math.log(2)\n  const deletionRate = .001\n  const model = PhylogeneticLikelihood.models.makeGappedModel ({ model: PhylogeneticLikelihood.models[PhylogeneticLikelihood.defaultModel],\n                                                                 deletionRate,\n                                                                 gapChar })\n  const { nodeProfile }\n        = PhylogeneticLikelihood.getNodePostProfiles ({ branchList: branches,\n                                                        nodeSeq: rowData,\n                                                        postProbThreshold: .01,\n                                                        model,\n                                                        defaultGapChar: gapChar })\n  Object.keys(nodeProfile).forEach ((node) => {\n    ancestralRowData[node] = nodeProfile[node].map ((charProb) => {\n      if (charProb[gapChar] >= .5)\n        return gapChar\n      const chars = Object.keys(charProb).filter ((c) => c !== gapChar).sort ((a, b) => charProb[a] - charProb[b])\n      const norm = chars.reduce ((psum, c) => psum + charProb[c], 0)\n      const probs = chars.map ((c) => charProb[c] / norm)\n      const entropy = probs.reduce ((s, p) => s - p * Math.log(p), 0) / Math.log(2)\n      return chars.map ((c, n) => [c, probs[n] * (maxEntropy - entropy) / maxEntropy])\n    })\n  })\n  return { id, ancestralRowData }\n}\n","import React, { Component } from 'react';\n\nclass MSATree extends Component {\n  \n  constructor(props) {\n    super(props);\n    this.canvasRef = React.createRef()\n  }\n\n  render() {\n    const { treeWidth } = this.props.computedTreeConfig\n    const { treeHeight } = this.props.treeLayout\n    return (<div className=\"MSA-tree\"\n            style={{ minWidth: treeWidth }}>\n            <canvas className=\"MSA-tree-canvas\"\n            ref={this.canvasRef}\n            width={treeWidth}\n            height={treeHeight}\n            style={{ top: -this.props.scrollTop }}\n            />\n            </div>)\n  }\n\n  componentDidMount() {\n    this.renderTree()\n    this.canvasRef.current.addEventListener ('click', this.handleClick.bind(this))\n  }\n\n  componentWillUnmount() {\n    this.canvasRef.current.removeEventListener ('click', this.handleClick.bind(this))\n  }\n\n  componentDidUpdate() {\n    this.renderTree()\n  }\n\n  renderTree() {\n    const { treeIndex, treeLayout, computedView, computedTreeConfig } = this.props\n    const { collapsed, ancestorCollapsed, forceDisplayNode, nodeScale } = computedView\n    const { treeWidth, branchStrokeStyle, treeStrokeWidth, rowConnectorDash, nodeHandleRadius, nodeHandleFillStyle, collapsedNodeHandleFillStyle } = computedTreeConfig\n    const { nx, ny } = treeLayout\n    const treeCanvas = this.canvasRef.current\n    const ctx = treeCanvas.getContext('2d')\n    ctx.setTransform (1, 0, 0, 1, 0, 0)\n    ctx.globalAlpha = 1\n    ctx.clearRect (0, 0, treeCanvas.width, treeCanvas.height)\n    ctx.strokeStyle = branchStrokeStyle\n    ctx.fillStyle = branchStrokeStyle\n    ctx.lineWidth = treeStrokeWidth\n    const makeNodeHandlePath = (node) => {\n      ctx.beginPath()\n      ctx.arc (nx[node], ny[node], nodeHandleRadius, 0, 2*Math.PI)\n    }\n    const setAlpha = (node) => {\n      const scale = nodeScale[node]\n      ctx.globalAlpha = (typeof(scale) === 'undefined' || forceDisplayNode[node]) ? 1 : scale\n    }\n    let nodesWithHandles = treeIndex.nodes.filter ((node) => !ancestorCollapsed[node] && treeIndex.children[node].length)\n    treeIndex.nodes.forEach ((node) => {\n      if (!ancestorCollapsed[node]) {\n        if (!treeIndex.children[node].length) {\n          setAlpha (node)\n          ctx.setLineDash ([])\n          ctx.beginPath()\n          ctx.fillRect (nx[node], ny[node] - nodeHandleRadius, 1, 2*nodeHandleRadius)\n        }\n        if (treeIndex.children[node].length && !collapsed[node]) {\n          ctx.setLineDash ([])\n          treeIndex.children[node].forEach ((child) => {\n            setAlpha (child)\n            ctx.beginPath()\n            ctx.moveTo (nx[node], ny[node])\n            ctx.lineTo (nx[node], ny[child])\n            ctx.lineTo (nx[child], ny[child])\n            ctx.stroke()\n          })\n        }\n        ctx.globalAlpha = 1\n        if (treeIndex.children[node].length === 0 || forceDisplayNode[node]) {\n          setAlpha (node)\n          ctx.setLineDash (rowConnectorDash)\n          ctx.beginPath()\n          ctx.moveTo (nx[node], ny[node])\n          ctx.lineTo (treeWidth, ny[node])\n          ctx.stroke()\n        }\n      }\n    })\n    ctx.strokeStyle = branchStrokeStyle\n    ctx.setLineDash ([])\n    nodesWithHandles.forEach ((node) => {\n      setAlpha (node)\n      makeNodeHandlePath (node)\n      // hack: collapsed[node]===false (vs undefined) means that we are animating the open->collapsed transition\n      // so the node's descendants are visible, but the node itself is rendered as collapsed\n      if (collapsed[node] || (forceDisplayNode[node] && collapsed[node] !== false))\n        ctx.fillStyle = collapsedNodeHandleFillStyle\n      else {\n        ctx.fillStyle = nodeHandleFillStyle\n        ctx.stroke()\n      }\n      ctx.fill()\n    })\n    this.nodesWithHandles = nodesWithHandles\n  }  \n\n  handleClick (evt) {\n    evt.preventDefault()\n    const { treeLayout } = this.props\n    const mouseX = parseInt (evt.offsetX)\n    const mouseY = parseInt (evt.offsetY)\n    let closestNode, closestNodeDistSquared\n    this.nodesWithHandles.forEach ((node) => {\n        const distSquared = Math.pow (mouseX - treeLayout.nx[node], 2) + Math.pow (mouseY - treeLayout.ny[node], 2)\n        if (typeof(closestNodeDistSquared) === 'undefined' || distSquared < closestNodeDistSquared) {\n          closestNodeDistSquared = distSquared\n          closestNode = node\n        }\n      })\n      if (closestNode && closestNodeDistSquared <= Math.pow(this.props.config.nodeHandleClickRadius,2))\n        this.props.handleNodeClick (closestNode)\n  }\n}\n\nexport default MSATree;\n","import React, { Component } from 'react';\n\nclass MSAAlignNames extends Component {\n\n  render() {\n    const { data, computedFontConfig, treeIndex, config, computedView, treeLayout } = this.props\n    const structure = data.structure || {}\n    const { nameDivWidth } = config\n    const { nameFontName, nameFontSize } = computedFontConfig\n\n    const { nodeHeight } = treeLayout\n    \n    return (<div className=\"MSA-alignment-names\"\n            style={{ fontFamily: nameFontName,\n                     fontSize: nameFontSize + 'px',\n                     maxWidth: nameDivWidth }}>\n            <div className=\"MSA-alignment-names-content\"\n            style={{ top: -this.props.scrollTop }}>\n            { treeIndex.nodes\n              .filter ((node) => computedView.nodeVisible[node])\n              .map ((node, row) => {\n                const style = { height: nodeHeight[node] + 'px' }\n                const scale = this.props.view.nodeScale[node]\n                if (typeof(scale) !== 'undefined' && scale !== 1) {\n                  style.transform = 'scale(1,' + scale +')'\n                  style.opacity = scale\n                }\n                return (<div className=\"MSA-alignment-name\"\n                        key={node}\n                        style={style}>\n                        { structure[node]\n                          ? (<span\n                             className=\"MSA-alignment-name-link\"\n                             onClick={()=>this.props.handleNameClick(node)}\n                             style={{ fontFamily: nameFontName,\n                                      fontSize: nameFontSize + 'px' }}\n                             >\n                             { node }\n                             </span>)\n                          : (<span> { node } </span>) }\n                        </div>)\n              }) }\n            </div>\n            </div>)\n  }\n\n}\n\nexport default MSAAlignNames;\n","import React, { Component } from 'react';\n\nclass MSAAlignCanvas extends Component {\n  \n  constructor(props) {\n    super(props);\n    this.state = { clientWidth: 0,\n                   clientHeight: 0 }\n    this.canvasRef = React.createRef()\n  }\n\n  render() {\n    const { top, left, width, height } = this.getDimensions()\n    return (<canvas\n            ref={this.canvasRef}\n            className=\"MSA-alignment-canvas\"\n            width={width}\n            height={height}\n            style={{top,left}}\n            />)\n  }\n\n  getColor (c) {\n    const { color } = this.props.computedFontConfig\n    return color[c.toUpperCase()] || color['default'] || 'black';\n  }\n\n  // offscreenRatio = the proportion of the rendered view that is invisible, on each side. Total rendered area = visible area * (1 + 2 * offscreenRatio)^2\n  getOffscreenRatio() { return 1 }\n\n  getDimensions() {\n    const { scrollLeft, scrollTop } = this.props\n    const { clientWidth, clientHeight } = this.state\n    const offscreenRatio = this.getOffscreenRatio()\n    const offscreenWidth = offscreenRatio * clientWidth, offscreenHeight = offscreenRatio * clientHeight\n    const top = Math.max (0, scrollTop - offscreenHeight),\n          left = Math.max (0, scrollLeft - offscreenWidth),\n          bottom = Math.min (this.props.treeLayout.treeHeight, scrollTop + clientHeight + offscreenHeight),\n          right = Math.min (this.props.alignLayout.alignWidth, scrollLeft + clientWidth + offscreenWidth),\n          width = right - left,\n          height = bottom - top\n    return { top, left, bottom, right, width, height }\n  }\n  \n  setClientSize (clientWidth, clientHeight) {\n    if (clientWidth !== this.state.clientWidth\n        || clientHeight !== this.state.clientHeight)\n      this.setState ({ clientWidth, clientHeight })\n  }\n  \n  componentDidMount() {\n    this.renderVisibleRegion()\n  }\n  \n  componentDidUpdate() {\n    this.renderVisibleRegion()\n  }\n\n  renderVisibleRegion() {\n    const alignCanvas = this.canvasRef.current\n    const ctx = alignCanvas.getContext('2d')\n    const { top, left, bottom, right } = this.getDimensions()\n    const { computedFontConfig, treeLayout, alignLayout, treeIndex, alignIndex, data } = this.props\n    const { rowData } = data\n    ctx.setTransform (1, 0, 0, 1, 0, 0)\n    ctx.globalAlpha = 1\n    ctx.clearRect (0, 0, alignCanvas.width, alignCanvas.height)\n    ctx.font = computedFontConfig.charFont\n    let firstRow, lastRow  // firstRow is first (partially) visible row, lastRow is last (partially) visible row\n    for (let row = firstRow = 0; row < treeLayout.rowHeight.length && treeLayout.rowY[row] < bottom; ++row) {\n      if (treeLayout.rowY[row] < top)\n        firstRow = row\n      lastRow = row\n    }\n    let colX = 0\n    for (let col = 0; col < alignIndex.columns && colX < right; ++col) {\n      const xScale = alignLayout.computedColScale[col],\n            colX = alignLayout.colX[col],\n            width = alignLayout.colWidth[col]\n      if (xScale && colX + width >= left)\n        for (let row = firstRow; row <= lastRow; ++row) {\n          const yScale = treeLayout.computedRowScale[row],\n                rowY = treeLayout.rowY[row],\n                height = treeLayout.rowHeight[row],\n                seq = rowData[treeIndex.nodes[row]]\n          if (height && seq) {\n            ctx.globalAlpha = Math.min (xScale, yScale)\n            const c = seq[col]\n            if (typeof(c) === 'string') {\n              ctx.setTransform (xScale, 0, 0, yScale, colX - left, rowY + height - top)\n              ctx.fillStyle = this.getColor (c)\n              ctx.fillText (c, 0, 0)\n            } else {\n              let psum = 0\n              c.forEach ((cp) => {\n                const ci = cp[0], p = cp[1]\n                ctx.setTransform (xScale, 0, 0, yScale * p, colX - left, rowY + height*(1-psum) - top)\n                ctx.fillStyle = this.getColor (ci)\n                ctx.fillText (ci, 0, 0)\n                psum += p\n              })\n            }\n          }\n        }\n    }\n  }\n}\n\nexport default MSAAlignCanvas;\n","import React, { Component } from 'react';\n\nimport MSAAlignCanvas from './MSAAlignCanvas';\n\nclass MSAAlignRows extends Component {\n  \n  constructor(props) {\n    super(props);\n    this.rowsDivRef = React.createRef()\n    this.alignCanvasRef = React.createRef()\n  }\n\n  render() {\n    const { treeHeight } = this.props.treeLayout\n    const { alignWidth } = this.props.alignLayout\n\n    return (<div className=\"MSA-alignment-rows\"\n            ref={this.rowsDivRef}\n            onClick={this.handleClick.bind(this)}\n            onMouseMove={this.handleMouseMove.bind(this)}\n            onMouseLeave={this.handleMouseLeave.bind(this)}\n            onMouseDown={this.handleMouseDown.bind(this)}\n            onScroll={this.handleScroll.bind(this)}>\n\n            <MSAAlignCanvas\n            ref={this.alignCanvasRef}\n            data={this.props.data}\n            treeIndex={this.props.treeIndex}\n            alignIndex={this.props.alignIndex}\n            treeLayout={this.props.treeLayout}\n            alignLayout={this.props.alignLayout}\n            computedFontConfig={this.props.computedFontConfig}\n            scrollLeft={this.props.scrollLeft}\n            scrollTop={this.props.scrollTop}\n            />\n\n            {this.props.hoverColumn !== null\n             ? (<div className=\"MSA-alignment-column-cursor\"\n                style={{ left: this.props.alignLayout.colX[this.props.hoverColumn],\n                         top: 0,\n                         width: this.props.alignLayout.colWidth[this.props.hoverColumn],\n                         height: this.props.treeLayout.treeHeight }}/>)\n             : ''}\n\n            <div className=\"MSA-alignment-rows-back\"\n            style={{ width: alignWidth,\n                     height: treeHeight }} />\n\n            </div>)\n  }\n\n  componentDidUpdate() {\n    this.setScrollPos()\n    this.setClientSize()\n  }\n  \n  componentDidMount() {\n    this.setScrollPos()\n    this.setClientSize()\n    window.addEventListener ('resize', this.setClientSize.bind(this))\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener ('resize', this.setClientSize.bind(this))\n  }\n\n  setClientSize() {\n    this.props.setClientSize (this.rowsDivRef.current.clientWidth,\n                              this.rowsDivRef.current.clientHeight)\n    this.alignCanvasRef.current.setClientSize (this.rowsDivRef.current.clientWidth,\n                                               this.rowsDivRef.current.clientHeight)\n  }\n  \n  setScrollPos (opts) {\n    opts = opts || this.props\n    this.rowsDivRef.current.scrollLeft = opts.scrollLeft\n    this.rowsDivRef.current.scrollTop = opts.scrollTop\n  }\n\n  handleClick (evt) {\n    this.props.handleAlignCharClick (this.resolveAlignCoords (evt))\n  }\n\n  handleMouseMove (evt) {\n    const coords = this.resolveAlignCoords (evt)\n    if (!this.lastCoords || coords.row !== this.lastCoords.row || coords.column !== this.lastCoords.column) {\n      this.props.handleAlignCharMouseOut (this.lastCoords)\n      this.props.handleAlignCharMouseOver (coords)\n      this.lastCoords = coords\n    }\n  }\n\n  handleMouseLeave (evt) {\n    this.props.handleMouseLeave (evt)\n  }\n\n  handleMouseDown (evt) {\n    this.props.handleMouseDown (evt)\n  }\n\n  handleScroll (evt) {\n    this.props.handleScroll (this.rowsDivRef.current.scrollLeft,\n                             this.rowsDivRef.current.scrollTop)\n  }\n\n  resolveAlignCoords (evt) {\n    const { treeIndex, alignIndex, treeLayout, alignLayout, data } = this.props\n    const { rowData } = data\n    const x = parseInt (evt.nativeEvent.offsetX),\n          y = parseInt (evt.nativeEvent.offsetY)\n    let row, column\n    for (row = 0; row < treeIndex.nodes.length - 1; ++row)\n      if (treeLayout.rowY[row] <= y && treeLayout.rowY[row] + treeLayout.rowHeight[row] > y)\n        break\n    for (column = 0; column < alignIndex.columns - 1; ++column)\n      if (alignLayout.colX[column] <= x && alignLayout.colX[column] + alignLayout.colWidth[column] > x)\n        break\n    const node = treeIndex.nodes[row],\n          colToSeqPos = alignIndex.alignColToSeqPos[node],\n          seqPos = colToSeqPos && colToSeqPos[column],\n          seq = rowData[node],\n          c = seq && seq[column],\n          isGap = this.props.isGapChar(c)\n    return { row, column, node, seqPos, c, isGap }\n  }\n}\n\nexport default MSAAlignRows;\n","import React, { Component } from 'react';\nimport { Select, MenuItem } from '@material-ui/core';\nimport CloseIcon from '@material-ui/icons/Close';\nimport { isArray } from 'lodash';\nimport pv from 'bio-pv';\n\nclass MSAStruct extends Component {\n\n  constructor(props) {\n    super(props);\n    this.pvDivRef = React.createRef()\n  }\n\n  render() {\n    const wantStructure = isArray(this.props.structure.structureInfo)\n    const structureID = !wantStructure && this.props.structure.structureInfo.pdb\n    return (<div\n            className=\"MSA-structure\"\n            style={{width: this.props.config.width,\n                    height: this.props.config.height}}\n            >\n\n            <div className=\"MSA-structure-name\">\n            {this.props.structure.node}\n            </div>\n\n            { structureID\n              && (<div className=\"MSA-structure-label\">\n                  {structureID}\n                  </div>) }\n\n            <div className=\"MSA-structure-top\">\n            { wantStructure\n              && (<Select\n                  value=''\n                  displayEmpty\n                  onChange={this.handleSelectStructure.bind(this)}\n                  >\n                  <MenuItem value='' disabled>\n                  Select a structure\n                  </MenuItem>\n                  {this.props.structure.structureInfo.map ((info, n) => (<MenuItem key={n} value={info}>{info.pdb}</MenuItem>))}\n                  </Select>\n                 ) }\n            <div className=\"MSA-structure-close-button\">\n            <CloseIcon onClick={this.handleClose.bind(this)}/>\n            </div>\n            </div>\n            \n            <div\n            className=\"MSA-structure-pv\"\n            ref={this.pvDivRef}\n            />\n            \n            </div>)\n  }\n\n  getPvConfig (structureConfig) {\n    const { width, height } = structureConfig\n    return (structureConfig.pvConfig\n            || { width,\n                 height,\n                 antialias: true,\n                 quality : 'medium' })\n  }\n\n  pdbUrlPrefix() { return 'https://files.rcsb.org/download/' }\n  pdbUrlSuffix() { return '.pdb' }\n  \n  componentDidMount() {\n    this.updatePv()\n  }\n\n  componentDidUpdate() {\n    this.updatePv()\n  }\n\n  updatePv() {\n    if (!isArray (this.props.structure.structureInfo))\n      this.loadStructure()\n  }\n  \n  handleSelectStructure (evt) {\n    this.props.updateStructure ({ structureInfo: evt.target.value })\n  }\n  \n  loadStructure() {\n    if (!this.props.structure.pdbFetchInitiated) {\n      this.props.updateStructure ({ pdbFetchInitiated: true })\n      const structureConfig = this.props.config\n      const pvConfig = this.getPvConfig (structureConfig)\n      const viewer = pv.Viewer (this.pvDivRef.current, pvConfig)\n      const loadFromPDB = !structureConfig.noRemoteStructures\n      const pdbFilePath = ((loadFromPDB\n                            ? this.pdbUrlPrefix()\n                            : (structureConfig.pdbPrefix || ''))\n                           + this.props.structure.structureInfo.pdb\n                           + (loadFromPDB\n                              ? this.pdbUrlSuffix()\n                              : (structureConfig.pdbSuffix || '')))\n      pv.io.fetchPdb (pdbFilePath, (pdb) => {\n        // display the protein as cartoon, coloring the secondary structure\n        // elements in a rainbow gradient.\n        this.props.updateStructure ({ pdb, viewer })\n        this.props.setViewType()\n        viewer.centerOn(pdb)\n        viewer.autoZoom()\n\n        this.pvDivRef.current.addEventListener ('mousemove', (evt) => {\n          const rect = viewer.boundingClientRect()\n          const picked = viewer.pick ({ x : evt.clientX - rect.left,\n                                        y : evt.clientY - rect.top })\n          if (picked) {\n            const target = picked.target(), residue = target.residue(), seqPos = residue.num(), chain = residue.chain().name()\n            this.props.handleMouseoverResidue (chain, seqPos)\n          }\n        })\n      })\n    }\n  }\n\n  handleClose (evt) {\n    evt.preventDefault();\n    this.props.handleCloseStructure (this.props.structure)\n  }\n}\n\nexport default MSAStruct;\n","import React, { Component } from 'react';\nimport { isArray } from 'lodash';\nimport pv from 'bio-pv';\n\nimport { Select, MenuItem, FormControlLabel, Checkbox } from '@material-ui/core';\n\nimport MSAStruct from './MSAStruct';\n\nclass MSAStructPanel extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = { config: this.props.initConfig,\n                   viewMode: 'cartoon',\n                   colorScheme: 'ssSuccession' }\n  }\n  \n  render() {\n    return (this.props.structures.length\n            ? (<div className=\"MSA-structure-panel\">\n\n               <div className=\"MSA-structure-controls\">\n               \n               <Select\n               value={this.state.viewMode}\n               onChange={this.handleSelectViewType.bind(this)}\n               >\n               <MenuItem value='cartoon'>Cartoons</MenuItem>\n               <MenuItem value='tube'>Tube</MenuItem>\n               <MenuItem value='spheres'>Spheres</MenuItem>\n               <MenuItem value='ballsAndSticks'>Balls and sticks</MenuItem>\n               </Select>\n               \n               <Select\n               value={this.state.colorScheme}\n               onChange={this.handleSelectColorScheme.bind(this)}\n               >\n               <MenuItem value='uniform'>Uniform</MenuItem>\n               <MenuItem value='byChain'>Chain</MenuItem>\n               <MenuItem value='bySS'>Secondary structure</MenuItem>\n               <MenuItem value='ssSuccession'>Secondary structure gradient</MenuItem>\n               <MenuItem value='rainbow'>Rainbow</MenuItem>\n               </Select>\n\n               <FormControlLabel\n               control={<Checkbox\n                        checked={this.state.config.showMouseoverLabel}\n                        onChange={this.handleMouseoverLabelConfig.bind(this)}/>}\n               label=\"Show label on hover\"\n               />\n\n               </div>\n\n               <div className=\"MSA-structures\">\n               {this.props.structures.map ((structure) => {\n                 return (<MSAStruct\n                         key={structure.key}\n                         structure={structure}\n                         config={this.state.config}\n                         setViewType={()=>this.setViewType(structure)}\n                         updateStructure={(info) => this.props.updateStructure(structure,info)}\n                         handleCloseStructure={this.props.handleCloseStructure}\n                         handleMouseoverResidue={(chain,pdbSeqPos)=>this.props.handleMouseoverResidue(structure,chain,pdbSeqPos)}\n                         />)\n               })}\n               </div>\n\n               </div>)\n            : '')\n  }\n\n  handleMouseoverLabelConfig (event) {\n    let config = this.state.config\n    config.showMouseoverLabel = event.target.checked\n    this.setState ({ config })\n  }\n  \n  redrawStructureDelay() { return 500 }\n\n  setViewType (structure, viewMode, colorScheme) {\n    viewMode = viewMode || this.state.viewMode\n    colorScheme = colorScheme || this.state.colorScheme\n    const { pdb, viewer } = structure\n    if (viewer) {\n      viewer.clear()\n      const geometry = viewer.renderAs ('protein', pdb, viewMode, { color : pv.color[colorScheme]() })\n      this.props.updateStructure (structure, { geometry })\n    }\n    this.props.structures.forEach ((s) => {\n      this.props.updateStructure (s, { trueAtomColor: {} })\n    })\n    this.requestRedrawStructures()\n  }\n\n  handleSelectViewType (evt) {\n    const viewMode = evt.target.value\n    this.setState ({ viewMode })\n    this.props.structures.forEach ((s) => this.setViewType (s, viewMode))\n  }\n\n  handleSelectColorScheme (evt) {\n    const colorScheme = evt.target.value\n    this.setState ({ colorScheme })\n    this.props.structures.forEach ((s) => this.setViewType (s, undefined, colorScheme))\n  }\n  \n  addLabelToStructuresOnMouseover (column) {\n    const labelConfig = this.state.config.label || { font: 'sans-serif',\n                                                     fontSize : 12,\n                                                     fontColor: '#f62',\n                                                     fillStyle: 'white',\n                                                     backgroundAlpha : 0.4 }\n    const atomHighlightColor = this.state.config.atomHighlightColor || 'red'\n    this.props.structures.forEach ((s) => {\n      const colToSeqPos = this.props.alignIndex.alignColToSeqPos[s.node]\n      if (colToSeqPos) {\n        const seqPos = colToSeqPos[column]\n        this.removeMouseoverLabels (s)\n        if (!isArray (s.structureInfo))\n          s.structureInfo.chains.forEach ((chainInfo) => {\n            const pdbSeqPos = seqPos + chainInfo.startPos\n            if (!chainInfo.endPos || pdbSeqPos <= chainInfo.endPos) {\n              const pdbChain = chainInfo.chain\n              const residues = s.pdb.residueSelect ((res) => {\n                return res.num() === pdbSeqPos\n                  && (typeof(pdbChain) === 'undefined' || res.chain().name() === pdbChain)\n              })\n              if (residues) {\n                residues.eachResidue ((res) => {\n                  const label = 'mouseover' + (s.mouseoverLabel.length + 1)\n                  if (this.state.config.showMouseoverLabel)\n                    s.viewer.label (label, res.qualifiedName(), res.centralAtom().pos(), labelConfig)\n                  res.atoms().forEach ((atom) => {\n                    if (!s.trueAtomColor[atom.index()]) {\n                      const atomColor = [0, 0, 0, 0]\n                      s.geometry.getColorForAtom (atom, atomColor)\n                      s.trueAtomColor[atom.index()] = atomColor\n                    }\n                  })\n                  this.setColorForAtoms (s.geometry, res.atoms(), atomHighlightColor)\n                  s.mouseoverLabel.push ({ label, res })\n                })\n              }\n            }\n          })\n      }\n    })\n    this.requestRedrawStructures()\n  }\n\n  removeLabelFromStructuresOnMouseout() {\n    this.props.structures.forEach ((s) => {\n      this.removeMouseoverLabels (s)\n    })\n    this.requestRedrawStructures()\n  }\n\n  removeMouseoverLabels (structure) {\n    structure.mouseoverLabel.forEach ((labelInfo) => {\n      if (this.state.config.showMouseoverLabel)\n        structure.viewer.rm (labelInfo.label)\n      let byColor = {}\n      labelInfo.res.atoms().forEach ((atom) => {\n        const trueColor = structure.trueAtomColor[atom.index()], colorString = trueColor.toString()\n        byColor[colorString] = byColor[colorString] || { trueColor, atoms: [] }\n        byColor[colorString].atoms.push (atom)\n      })\n      Object.keys(byColor).forEach ((col) => this.setColorForAtoms (structure.geometry, byColor[col].atoms, byColor[col].trueColor))\n    })\n    structure.mouseoverLabel = []\n  }\n\n  setColorForAtoms (go, atoms, color) {\n    let view = go.structure().createEmptyView()\n    atoms.forEach ((atom) => view.addAtom (atom))\n    go.colorBy (pv.color.uniform(color), view)\n  }\n\n  // delayed request to redraw structure\n  requestRedrawStructures() {\n    this.props.setTimer ('redraw', this.redrawStructureDelay(), () => {\n      this.props.structures.filter ((s) => s.viewer).forEach ((s) => s.viewer.requestRedraw())\n    })\n  }\n}\n\nexport default MSAStructPanel;\n","import React, { Component } from 'react';\nimport { extend } from 'lodash';\n\nimport MSATree from './MSATree';\nimport MSAAlignNames from './MSAAlignNames';\nimport MSAAlignRows from './MSAAlignRows';\nimport MSAStructPanel from './MSAStructPanel';\n\nclass MSA extends Component {\n  constructor(props) {\n    super(props);\n\n    const view = extend (this.initialView(),\n                         props.view || {})\n\n    this.state = extend ({ scrollTop: 0,\n                           alignScrollLeft: 0,\n                           hoverColumn: null },\n                         { view });\n\n    this.rowsRef = React.createRef()\n    this.msaRef = React.createRef()\n    this.structRef = React.createRef()\n  }\n\n  // config/defaults\n  initialView() {\n    return {\n      collapsed: {},   // true if an internal node has been collapsed by the user\n      forceDisplayNode: {},   // force a node to be displayed even if it's flagged as collapsed. Used by animation code\n      nodeScale: {},  // height scaling factor for tree nodes / alignment rows. From 0 to 1 (undefined implies 1)\n      columnScale: {},  // height scaling factor for alignment columns. From 0 to 1 (undefined implies 1)\n      disableTreeEvents: false,\n      animating: false,\n      structure: { openStructures: [] }\n    } }\n\n  collapseAnimationFrames() { return 10 }\n  collapseAnimationDuration() { return 200 }\n  collapseAnimationMaxFrameSkip() { return 8 }\n\n  mouseoverLabelDelay() { return 100 }\n\n  resetView() {\n    this.setState ({ view: this.initialView() })\n  }\n  \n  // get tree collapsed/open state\n  getComputedView (view) {\n    view = view || this.state.view\n    const { treeIndex, alignIndex } = this.props\n    const { collapsed, forceDisplayNode } = view\n    const { rowDataAsArray } = alignIndex\n    let ancestorCollapsed = {}, nodeVisible = {}\n    const setCollapsedState = (node, parent) => {\n      ancestorCollapsed[node] = ancestorCollapsed[parent] || collapsed[parent]\n      const kids = treeIndex.children[node]\n      if (kids)\n        kids.forEach ((child) => setCollapsedState (child, node))\n    }\n    setCollapsedState (treeIndex.root)\n    treeIndex.nodes.forEach ((node) => nodeVisible[node] = (!ancestorCollapsed[node]\n                                                              && (treeIndex.children[node].length === 0\n                                                                  || forceDisplayNode[node])))\n    let columnVisible = new Array(alignIndex.columns).fill(false)\n    treeIndex.nodes.filter ((node) => nodeVisible[node]).forEach ((node) => {\n      if (rowDataAsArray[node])\n        rowDataAsArray[node].forEach ((c, col) => { if (!this.props.isGapChar(c)) columnVisible[col] = true })\n    })\n    return extend ({ ancestorCollapsed, nodeVisible, columnVisible },\n                   view)\n  }\n  \n  // layout tree\n  layoutTree (computedView) {\n    const { computedTreeConfig, treeIndex } = this.props\n    const { nodeVisible, nodeScale } = computedView\n    const { genericRowHeight, nodeHandleRadius, treeStrokeWidth, availableTreeWidth, scrollbarHeight } = computedTreeConfig\n    let nx = {}, ny = {}, computedRowScale = [], nodeHeight = {}, rowHeight = [], treeHeight = 0\n    const rowY = treeIndex.nodes.map ((node) => {\n      const scale = typeof(nodeScale[node]) !== 'undefined' ? nodeScale[node] : 1\n      const rh = scale * (nodeVisible[node] ? genericRowHeight : 0)\n      const y = treeHeight\n      nx[node] = nodeHandleRadius + treeStrokeWidth + availableTreeWidth * treeIndex.distFromRoot[node] / treeIndex.maxDistFromRoot\n      ny[node] = y + rh / 2\n      nodeHeight[node] = rh\n      computedRowScale.push (scale)\n      rowHeight.push (rh)\n      treeHeight += rh\n      return y\n    })\n    treeHeight += scrollbarHeight\n    return { nx, ny, computedRowScale, nodeHeight, rowHeight, rowY, treeHeight, computedView }\n  }\n\n  // get metrics and other info about alignment font/chars, and do layout\n  layoutAlignment (computedView) {\n    const { alignIndex, computedFontConfig } = this.props\n    const { genericRowHeight, charFont } = computedFontConfig\n    const alignChars = alignIndex.chars\n    let charWidth = 0, charMetrics = {}\n    alignChars.forEach ((c) => {\n      let measureCanvas = this.create ('canvas', null, null, { width: genericRowHeight, height: genericRowHeight })\n      let measureContext = measureCanvas.getContext('2d')\n      measureContext.font = charFont\n      charMetrics[c] = measureContext.measureText (c)\n      charWidth = Math.max (charWidth, Math.ceil (charMetrics[c].width))\n    })\n    const charHeight = genericRowHeight\n\n    let nextColX = 0, colX = [], colWidth = [], computedColScale = []\n    for (let col = 0; col < alignIndex.columns; ++col) {\n      colX.push (nextColX)\n      if (computedView.columnVisible[col]) {\n        let scale = computedView.columnScale[col]\n        if (typeof(scale) === 'undefined')\n          scale = 1\n        computedColScale.push (scale)\n        const width = scale * charWidth\n        colWidth.push (width)\n        nextColX += width\n      } else {\n        computedColScale.push (0)\n        colWidth.push (0)\n      }\n    }\n\n    return { charMetrics, charWidth, charHeight, colX, colWidth, computedColScale, alignWidth: nextColX }\n  }\n\n  // helper to create DOM element (for measurement purposes, or non-React components)\n  create (type, parent, styles, attrs) {\n    const element = document.createElement (type)\n    if (parent)\n      parent.appendChild (element)\n    if (attrs)\n      Object.keys(attrs).filter ((attr) => typeof(attrs[attr]) !== 'undefined').forEach ((attr) => element.setAttribute (attr, attrs[attr]))\n    if (styles)\n      element.style = styles\n    return element\n  }\n  \n  render() {\n    const computedView = this.getComputedView()\n    const treeLayout = this.layoutTree (computedView)\n    const alignLayout = this.layoutAlignment (computedView)\n\n    // record the dimensions for drag handling\n    this.treeHeight = treeLayout.treeHeight\n    this.alignWidth = alignLayout.alignWidth\n    \n    return (\n        <div className=\"MSA\"\n      style={{ width: this.props.config.containerWidth,\n               height: this.props.config.containerHeight }}>\n\n        <div className=\"MSA-tree-alignment\"\n      ref={this.msaRef}\n      onMouseDown={this.handleMouseDown.bind(this)}\n      style={{ width: this.props.config.containerWidth,\n               height: treeLayout.treeAlignHeight }}>\n\n        <MSATree\n      config={this.props.config}\n      computedTreeConfig={this.props.computedTreeConfig}\n      treeIndex={this.props.treeIndex}\n      treeLayout={treeLayout}\n      computedView={computedView}\n      scrollTop={this.state.scrollTop}\n      handleNodeClick={this.handleNodeClick.bind(this)}\n        />\n\n        <MSAAlignNames\n      data={this.props.data}\n      view={this.state.view}\n      config={this.props.config}\n      computedFontConfig={this.props.computedFontConfig}\n      treeIndex={this.props.treeIndex}\n      alignIndex={this.props.alignIndex}\n      treeLayout={treeLayout}\n      alignLayout={alignLayout}\n      computedView={computedView}\n      scrollTop={this.state.scrollTop}\n      handleNameClick={this.handleNameClick.bind(this)}\n        />\n      \n        <MSAAlignRows\n      ref={this.rowsRef}\n      data={this.props.data}\n      view={this.state.view}\n      config={this.props.config}\n      computedFontConfig={this.props.computedFontConfig}\n      treeIndex={this.props.treeIndex}\n      alignIndex={this.props.alignIndex}\n      isGapChar={this.props.isGapChar}\n      treeLayout={treeLayout}\n      alignLayout={alignLayout}\n      setClientSize={this.setAlignmentClientSize.bind(this)}\n      handleScroll={this.handleAlignmentScroll.bind(this)}\n      handleMouseDown={this.handleAlignmentMouseDown.bind(this)}\n      handleAlignCharClick={this.handleAlignCharClick.bind(this)}\n      handleAlignCharMouseOver={this.handleAlignCharMouseOver.bind(this)}\n      handleAlignCharMouseOut={this.handleAlignCharMouseOut.bind(this)}\n      handleMouseLeave={()=>this.delayedSetHoverColumn(null)}\n      scrollLeft={this.state.alignScrollLeft}\n      scrollTop={this.state.scrollTop}\n      hoverColumn={this.state.hoverColumn}\n        />\n        </div>\n\n        <MSAStructPanel\n      ref={this.structRef}\n      initConfig={this.props.config.structure}\n      alignIndex={this.props.alignIndex}\n      structures={this.state.view.structure.openStructures}\n      updateStructure={this.updateStructure.bind(this)}\n      handleCloseStructure={this.handleCloseStructure.bind(this)}\n      handleMouseoverResidue={this.handleMouseoverStructureResidue.bind(this)}\n      setTimer={this.setTimer.bind(this)}\n        />\n\n      </div>\n    )\n  }\n\n  componentDidMount() {\n    window.addEventListener ('mouseleave', this.handleMouseLeave.bind(this))\n    window.addEventListener ('mouseup', this.handleMouseUp.bind(this))\n    window.addEventListener ('mousemove', this.handleMouseMove.bind(this))\n    this.msaRef.current.addEventListener ('wheel', this.handleMouseWheel.bind(this), { passive: false })\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener ('mouseleave', this.handleMouseLeave.bind(this))\n    window.removeEventListener ('mouseup', this.handleMouseUp.bind(this))\n    window.removeEventListener ('mousemove', this.handleMouseMove.bind(this))\n    this.msaRef.current.removeEventListener ('wheel', this.handleMouseWheel.bind(this))\n  }\n\n  setAlignmentClientSize (w, h) {\n    this.alignmentClientWidth = w\n    this.alignmentClientHeight = h\n  }\n\n  handleNameClick (node) {\n    const { structure } = this.props.data\n    this.nStructs = (this.nStructs || 0) + 1\n    const newStructure = { node,\n                           structureInfo: structure[node],\n                           startPos: this.props.data.seqCoords[node].startPos,\n                           mouseoverLabel: [],\n                           trueAtomColor: {},\n                           key: this.nStructs }\n    let view = this.state.view\n    view.structure.openStructures.push (newStructure)\n    this.setState ({ view })\n  }\n\n  updateStructure (structure, newStructure) {\n    let view = this.state.view\n    view.structure.openStructures = view.structure.openStructures\n      .map ((s) => (s === structure\n                    ? extend (s, newStructure)\n                    : s))\n    this.setState ({ view })\n  }\n\n  handleCloseStructure (structure) {\n    let view = this.state.view\n    view.structure.openStructures = view.structure.openStructures.filter ((s) => s !== structure)\n    this.setState ({ view })\n  }\n  \n  handleNodeClick (node) {\n    if (this.scrolling) {\n      this.scrolling = false\n      return\n    }\n    if (this.state.disableTreeEvents)\n      return\n\n    const { treeIndex, alignIndex } = this.props\n    const computedView = this.getComputedView()\n    const { collapsed, nodeScale, columnScale, forceDisplayNode, columnVisible } = computedView\n\n    const alignLayout = this.layoutAlignment (computedView)\n    const left = this.state.alignScrollLeft, right = left + this.alignmentClientWidth\n\n    const collapseAnimationFrames = this.collapseAnimationFrames()\n    let framesLeft = collapseAnimationFrames\n\n    const wasCollapsed = collapsed[node], finalCollapsed = extend ({}, collapsed)\n    if (wasCollapsed) {\n      collapsed[node] = false  // when collapsed[node]=false (vs undefined), it's rendered by renderTree() as a collapsed node, but its descendants are still visible. A bit of a hack...\n      delete finalCollapsed[node]\n    } else\n      finalCollapsed[node] = true\n    const finalForceDisplayNode = extend ({}, forceDisplayNode)\n    finalForceDisplayNode[node] = !wasCollapsed\n    const finalComputedView = this.getComputedView ({ collapsed: finalCollapsed, forceDisplayNode: finalForceDisplayNode })\n    let newlyVisibleColumns = [], newlyHiddenColumns = [], persistingVisibleColumns = []\n    for (let col = 0; col < alignIndex.columns; ++col) {\n      if (finalComputedView.columnVisible[col] !== columnVisible[col])\n        (finalComputedView.columnVisible[node] ? newlyVisibleColumns : newlyHiddenColumns).push (col)\n      const colX = alignLayout.colX[col], colWidth = alignLayout.colWidth[col]\n      if (columnVisible[col] && finalComputedView.columnVisible[col] && colX >= left && colX + colWidth < right)\n        persistingVisibleColumns.push (col)\n    }\n    const centroidMinusScroll = this.centroidOfColumns (persistingVisibleColumns, alignLayout) - this.state.alignScrollLeft\n\n    let lastFrameTime = Date.now()\n    const expectedTimeBetweenFrames = this.collapseAnimationDuration() / collapseAnimationFrames\n    const drawAnimationFrame = () => {\n      let disableTreeEvents, animating, newCollapsed = collapsed\n      if (framesLeft) {\n        const scale = (wasCollapsed ? (collapseAnimationFrames + 1 - framesLeft) : framesLeft) / (collapseAnimationFrames + 1)\n        treeIndex.descendants[node].forEach ((desc) => { nodeScale[desc] = scale })\n        nodeScale[node] = 1 - scale\n        newlyHiddenColumns.forEach ((col) => columnScale[col] = scale)\n        newlyVisibleColumns.forEach ((col) => columnScale[col] = 1 - scale)\n        forceDisplayNode[node] = true\n        disableTreeEvents = true\n        animating = true\n      } else {\n        treeIndex.descendants[node].forEach ((desc) => { delete nodeScale[desc] })\n        delete nodeScale[node]\n        newlyHiddenColumns.forEach ((col) => delete columnScale[col])\n        newlyVisibleColumns.forEach ((col) => delete columnScale[col])\n        forceDisplayNode[node] = !wasCollapsed\n        newCollapsed = finalCollapsed\n        disableTreeEvents = false\n        animating = false\n      }\n      const view = extend ({}, this.state.view, { collapsed: newCollapsed, forceDisplayNode, nodeScale, columnScale, disableTreeEvents, animating })\n      const computedView = this.getComputedView (view), alignLayout = this.layoutAlignment (computedView)\n      const alignScrollLeft = this.boundAlignScrollLeft (this.centroidOfColumns (persistingVisibleColumns, alignLayout) - centroidMinusScroll)\n      window.requestAnimationFrame (() => {\n        this.setState ({ alignScrollLeft, view })\n        \n        if (framesLeft) {\n          const currentTime = Date.now(),\n                timeSinceLastFrame = currentTime - lastFrameTime,\n                timeToNextFrame = Math.max (0, expectedTimeBetweenFrames - timeSinceLastFrame),\n                frameSkip = Math.min (this.collapseAnimationMaxFrameSkip(), Math.ceil (timeSinceLastFrame / expectedTimeBetweenFrames))\n          framesLeft = Math.max (0, framesLeft - frameSkip)\n          lastFrameTime = currentTime\n          setTimeout (drawAnimationFrame, timeToNextFrame)\n        }\n      })\n    }\n                                    \n    drawAnimationFrame (collapseAnimationFrames)\n  }\n\n  handleAlignmentScroll (alignScrollLeft, scrollTop) {\n    if (alignScrollLeft !== this.state.alignScrollLeft\n        || scrollTop !== this.state.scrollTop)\n      this.setState ({ alignScrollLeft, scrollTop })\n  }\n\n  handleMouseWheel (evt) {\n    // nonzero deltaMode is Firefox, means deltaY is in lines instead of pixels\n    // can be corrected for e.g. https://stackoverflow.com/questions/20110224/what-is-the-height-of-a-line-in-a-wheel-event-deltamode-dom-delta-line\n    if (evt.deltaY !== 0) {\n      const deltaY = evt.deltaY * (evt.deltaMode ? this.props.config.genericRowHeight : 1)\n      evt.preventDefault()\n      this.requestAnimationFrame (() => {\n        this.setState ({ alignScrollLeft: this.incAlignScrollLeft (evt.deltaX),\n                         scrollTop: this.incScrollTop (deltaY) })\n      })\n    }\n  }\n\n  handleMouseDown (evt) {\n    this.mouseDown = true\n    this.lastY = evt.pageY\n  }\n\n  handleAlignmentMouseDown (evt) {\n    this.alignMouseDown = true\n    this.lastX = evt.pageX\n  }\n\n  handleAlignCharClick (coords) {\n    if (!this.panning && !this.scrolling) {\n//      console.warn('click',coords)\n    }\n    this.panning = this.scrolling = false\n  }\n\n  handleAlignCharMouseOver (coords) {\n    if (!this.panning && !this.scrolling) {\n      this.delayedSetHoverColumn (coords.column)\n//      console.warn('mouseover',coords)\n    }\n  }\n\n  handleAlignCharMouseOut (coords) {\n    if (!this.panning && !this.scrolling) {\n//      console.warn('mouseout',coords)\n    }\n  }\n\n  delayedSetHoverColumn (column) {\n    this.setMouseoverTimer (() => {\n      this.setHoverColumn (column)\n    })\n  }\n\n  setMouseoverTimer (callback) {\n    this.setTimer ('mouseover', this.mouseoverLabelDelay(), () => window.requestAnimationFrame (callback))\n  }\n\n  setHoverColumn (column) {\n    this.setState ({ hoverColumn: column })\n    if (column === null)\n      this.structRef.current.removeLabelFromStructuresOnMouseout()\n    else\n      this.structRef.current.addLabelToStructuresOnMouseover (column)\n  }\n\n  handleMouseoverStructureResidue (structure, chain, pdbSeqPos) {\n    this.setMouseoverTimer (() => {\n      const seqPosToCol = this.props.alignIndex.seqPosToAlignCol[structure.node]\n      const chainInfo = structure.structureInfo.chains.find ((c) => c.chain === chain)\n      if (seqPosToCol && chainInfo && pdbSeqPos >= chainInfo.startPos && pdbSeqPos <= chainInfo.endPos) {\n        const seqPos = pdbSeqPos - chainInfo.startPos\n        const column = seqPosToCol[seqPos]\n        this.setHoverColumn (column)\n      } else\n        this.setHoverColumn (null)\n    })\n  }\n  \n  handleMouseLeave() {\n    this.alignMouseDown = false\n    this.mouseDown = false\n    this.panning = this.scrolling = false\n  }\n\n  handleMouseUp() {\n    this.alignMouseDown = false\n    this.mouseDown = false\n  }\n\n  centroidOfColumns (cols, alignLayout) {\n    return cols.length && (cols.reduce ((sum, col) => sum + alignLayout.colX[col] + (alignLayout.colWidth[col] / 2), 0) / cols.length)\n  }\n\n  incAlignScrollLeft (dx) {\n    return this.boundAlignScrollLeft (this.state.alignScrollLeft + dx)\n  }\n\n  incScrollTop (dy) {\n    return this.boundScrollTop (this.state.scrollTop + dy)\n  }\n\n  boundAlignScrollLeft (x) {\n    return Math.max (0, Math.min (this.alignWidth - this.alignmentClientWidth, x))\n  }\n\n  boundScrollTop (y) {\n    return Math.max (0, Math.min (this.treeHeight - this.alignmentClientHeight, y))\n  }\n\n  handleMouseMove (evt) {\n    if (this.alignMouseDown || this.mousedown)\n      evt.preventDefault()\n\n    let { alignScrollLeft, scrollTop } = this.state, updated = false\n    if (this.alignMouseDown) {\n      const dx = evt.pageX - this.lastX\n      if (dx) {\n        alignScrollLeft = this.incAlignScrollLeft (-dx)\n        this.panning = true\n        updated = true\n      }\n    } else\n      this.panning = false\n\n    if (this.mouseDown) {\n      const dy = evt.pageY - this.lastY\n      if (dy) {\n        scrollTop = this.incScrollTop (-dy)\n        this.scrolling = true\n        updated = true\n      }\n    } else\n      this.scrolling = false\n\n    if (updated)\n      this.requestAnimationFrame (() => {\n        this.setState ({ alignScrollLeft, scrollTop })\n        this.lastX = evt.pageX\n        this.lastY = evt.pageY\n      })\n  }\n\n  // request animation frame\n  requestAnimationFrame (callback) {\n    if (this.animationTimeout)\n      window.cancelAnimationFrame (this.animationTimeout)\n    this.animationTimeout = window.requestAnimationFrame (callback)\n  }\n\n  // set generic timer\n  setTimer (name, delay, callback) {\n    this.timer = this.timer || {}\n    this.clearTimer (this, name)\n    this.timer[name] = window.setTimeout (() => {\n      delete this.timer[name]\n      callback()\n    }, delay)\n  }\n\n  // clear generic timer\n  clearTimer (name) {\n    if (this.timer && this.timer[name]) {\n      window.clearTimeout (this.timer[name])\n      delete this.timer[name]\n    }\n  }\n}\n\nexport default MSA;\n","import React, { Component } from 'react';\nimport { Select, MenuItem } from '@material-ui/core';\nimport { extend, isArray } from 'lodash';\nimport colorSchemes from './colorSchemes'\nimport './App.css';\n\nimport { getAncestralReconstruction } from './reconstruction';\n// eslint-disable-next-line import/no-webpack-loader-syntax\nimport getAncestralReconstructionWorker from 'workerize-loader!./reconstruction';\n\nimport Stockholm from 'stockholm-js';\nimport { Newick } from 'newick';\nimport JukesCantor from 'jukes-cantor';\nimport RapidNeighborJoining from 'neighbor-joining';\n\nimport MSA from './MSA';\n\nclass App extends Component {\n  \n  constructor(props) {\n    super(props);\n    \n    // config\n    const config = extend (this.defaultConfig(), props.config || {})\n    const { genericRowHeight, nameFontSize, treeWidth, branchStrokeStyle, nodeHandleRadius, nodeHandleClickRadius, nodeHandleFillStyle, collapsedNodeHandleFillStyle, rowConnectorDash } = config\n\n    // tree configuration\n    const treeStrokeWidth = 1\n    const nodeHandleStrokeStyle = branchStrokeStyle\n    const availableTreeWidth = treeWidth - nodeHandleRadius - 2*treeStrokeWidth\n    const scrollbarHeight = 20  // hack, could be platform-dependent, a bit fragile...\n    const computedTreeConfig = { treeWidth, availableTreeWidth, genericRowHeight, branchStrokeStyle, nodeHandleStrokeStyle, nodeHandleRadius, nodeHandleClickRadius, nodeHandleFillStyle, collapsedNodeHandleFillStyle, rowConnectorDash, treeStrokeWidth, scrollbarHeight }\n\n    // font configuration\n    const charFontName = 'Menlo,monospace'\n    const nameFontName = 'inherit'\n    const nameFontColor = 'black'\n    const charFont = genericRowHeight + 'px ' + charFontName\n    const color = config.color || colorSchemes[config.colorScheme]\n    const computedFontConfig = { charFont, charFontName, color, nameFontName, nameFontSize, nameFontColor, genericRowHeight }\n    \n    // state (we will select a dataset in componentDidMount())\n    this.state = { config,\n                   datasets: this.props.datasets || [],\n                   computedTreeConfig,\n                   computedFontConfig }\n\n    this.divRef = React.createRef()\n    this.inputRef = React.createRef()\n    this.msaRef = React.createRef()\n  }\n\n  handleDragEnter (evt) {\n    evt.stopPropagation()\n    evt.preventDefault()\n  }\n\n  handleDragOver (evt) {\n    evt.stopPropagation()\n    evt.preventDefault()\n    evt.dataTransfer.dropEffect = 'copy'\n  }\n\n  handleDrop (evt) {\n    evt.stopPropagation()\n    evt.preventDefault()\n    this.openFiles (evt.dataTransfer.files)\n  }\n  \n  handleSelectDataset (evt) {\n    const name = evt.target.value\n    if (name) {\n      this.setDataset (this.state.datasets.find ((ds) => ds.name === name))\n      this.msaRef.current.resetView()\n    } else\n      this.inputRef.current.click()\n  }\n\n  handleSelectFile (evt) {\n    this.openFiles (evt.target.files)\n  }\n  \n  openFiles (files) {\n    return Promise.all (Array.from(files).map ((file) => this.openFile (file)))\n  }\n  \n  openFile (file) {\n    return new Promise ((resolve, reject) => {\n      const reader = new FileReader()\n      reader.onload = (e) => {\n        const text = e.target.result\n        this.addDatasets (text, true)\n        resolve()\n      }\n      reader.readAsText (file)\n    })\n  }\n\n  addDatasets (text, autoselect) {\n    const newAlignmentName = (n) => \"Alignment \" + (this.state.datasets.length + (n || 0) + 1);\n    let datasets = this.state.datasets\n    if (this.sniffStockholmRegex.test (text)) {\n      const stocks = Stockholm.parseAll (text)\n      datasets = datasets.concat (stocks.map ((stockholmjs, n) => {\n        const name = stockholmjs.gf.ID ? stockholmjs.gf.ID[0] : newAlignmentName(n)\n        return { stockholmjs, name }\n      }))\n    } else {\n      try {\n        const json = JSON.parse (text)\n        if (isArray (json))\n          datasets = datasets.concat (json)\n        else\n          datasets.push (json)\n      } catch (e) {\n        datasets.push ({ auto: text,\n                         name: newAlignmentName() })\n      }\n    }\n    if (datasets.length > this.state.datasets.length) {\n      const firstDataset = datasets[this.state.datasets.length]\n      if (autoselect)\n        this.setDataset (firstDataset, { datasets })\n      else\n        this.setState ({ datasets })\n      if (this.msaRef.current)\n        this.msaRef.current.resetView()\n    }\n  }\n  \n  setDataset (data, extra) {\n    const datasetID = this.datasetsLoaded = (this.datasetsLoaded || 0) + 1\n    this.indexData (data)\n      .then ((dataWithIndices) => this.setState (extend ({ datasetID,\n                                                           reconstructingAncestors: false },\n                                                         dataWithIndices,\n                                                         extra || {})))\n  }\n\n  async indexData (suppliedData, suppliedConfig) {\n    const config = suppliedConfig || this.state.config\n    const data = await this.getData (config.cacheData ? suppliedData : extend ({}, suppliedData), config)\n    const treeIndex = this.buildTreeIndex (data)\n    const alignIndex = this.buildAlignmentIndex (data)\n    return { data, treeIndex, alignIndex }\n  }\n\n  // regexes\n  get pdbRegex() { return /PDB; +(\\S+) +(\\S); ([0-9]+)-([0-9]+)/; }   /* PFAM format for embedding PDB IDs in Stockholm files */\n  get nameEncodedCoordRegex() { return /\\/([0-9]+)-([0-9]+)$/; }   /* Pfam format for embedding coordinates in names (ugh) */\n  get sniffStockholmRegex() { return /^# STOCKHOLM/; }   /* regex for sniffing Stockholm format */\n  get sniffFastaRegex() { return /^>/; }   /* regex for sniffing FASTA format */\n\n  // method to get data & build tree if necessary\n  async getData (data, config) {\n    if (data.url)\n      await Promise.all (Object.keys (data.url)\n                         .filter (key => !data[key])\n                         .map ((key) => {\n                           const url = this.makeURL (data.url[key])\n                           return fetch (url).then (async (res) => {\n                             if (res.ok)\n                               data[key] = await res.text()\n                             else\n                               console.warn ('Error fetching ' + url, res.statusText)\n                           })}))\n    if (data.json)\n      extend (data, typeof(data.json) === 'string' ? JSON.parse(data.json) : data.json)\n    if (data.auto) {\n      if (this.sniffStockholmRegex.test (data.auto))\n        data.stockholm = data.auto\n      else if (this.sniffFastaRegex.test (data.auto))\n        data.fasta = data.auto\n      else {\n        try {\n          extend (data, JSON.parse (data.auto))\n        } catch (e) {\n          // do nothing if JSON didn't parse\n        }\n      }\n    }\n    if (!(data.branches && data.rowData)) {\n      if (data.stockholm)  // was a Stockholm-format alignment specified?\n        this.unpackStockholm (data, config, data.stockholm)\n      else if (data.stockholmjs)  // was a StockholmJS object specified?\n        this.unpackStockholmJS (data, config, data.stockholmjs)\n      else if (data.fasta)  // was a FASTA-format alignment specified?\n        data.rowData = this.parseFasta (data.fasta)\n      else\n        throw new Error (\"no sequence data\")\n      // If a Newick-format tree was specified somehow (as a separate data item, or in the Stockholm alignment) then parse it\n      if (data.newick || data.newickjs) {\n        const NewickParser = new Newick()\n        const newickTree = data.newickjs = data.newickjs || NewickParser.parse (data.newick)\n        let nodes = 0\n        const getName = (obj) => (obj.name = obj.name || ('node' + (++nodes)))\n        data.branches = []\n        const traverse = (parent) => {  // auto-name internal nodes\n          if (parent.branchset)\n            parent.branchset.forEach ((child) => {\n              data.branches.push ([getName(parent), getName(child), Math.max (child.length, 0)])\n              traverse (child)\n            })\n        }\n        traverse (newickTree)\n        data.root = getName (newickTree)\n      } else {  // no Newick tree was specified, so build a quick-and-dirty distance matrix with Jukes-Cantor, and get a tree by neighbor-joining\n        const taxa = Object.keys(data.rowData).sort(), seqs = taxa.map ((taxon) => data.rowData[taxon])\n        console.warn ('Estimating phylogenetic tree (' + taxa.length + ' taxa)...')\n        const distMatrix = JukesCantor.calcFiniteDistanceMatrix (seqs)\n        const rnj = new RapidNeighborJoining.RapidNeighborJoining (distMatrix, taxa.map ((name) => ({ name })))\n        rnj.run()\n        const tree = rnj.getAsObject()\n        let nodes = 0\n        const getName = (obj) => { obj.taxon = obj.taxon || { name: 'node' + (++nodes) }; return obj.taxon.name }\n        data.branches = []\n        const traverse = (parent) => {  // auto-name internal nodes\n          parent.children.forEach ((child) => {\n            data.branches.push ([getName(parent), getName(child), Math.max (child.length, 0)])\n            traverse (child)\n          })\n        }\n        traverse (tree)\n        data.root = getName (tree)\n      }\n    }\n    this.guessSeqCoords (data)  // this is an idempotent method; if data came from a Stockholm file, it's already been called (in order to filter out irrelevant structures)\n    return data\n  }\n\n    // Attempt to figure out start coords relative to database sequences by parsing the sequence names\n    // This allows us to align to partial structures\n    // This is pretty hacky; the user can alternatively pass these in through the data.seqCoords field\n  guessSeqCoords (data) {\n    if (!data.seqCoords)\n      data.seqCoords = {}\n    Object.keys (data.rowData).forEach ((name) => {\n      const seq = data.rowData[name], len = this.countNonGapChars (seq)\n      if (!data.seqCoords[name]) {\n        const coordMatch = this.nameEncodedCoordRegex.exec (name)\n        if (coordMatch) {\n          const startPos = parseInt(coordMatch[1]), endPos = parseInt(coordMatch[2])\n          if (endPos + 1 - startPos === len)\n            data.seqCoords[name] = { startPos, endPos }\n        }\n      }\n      if (!data.seqCoords[name])\n        data.seqCoords[name] = { startPos: 1, endPos: len }   // if we can't guess the start coord, just assume it's the full-length sequence\n    })\n  }\n  \n  makeURL (url) {\n    return url.replace ('%PUBLIC_URL%', process.env.PUBLIC_URL)\n  }\n  \n  unpackStockholm (data, config, stockholm) {\n    const stockjs = Stockholm.parse (stockholm)\n    this.unpackStockholmJS (data, config, stockjs)\n  }\n\n  unpackStockholmJS (data, config, stock) {\n    const structure = data.structure = data.structure || {}\n    data.rowData = stock.seqdata\n    this.guessSeqCoords (data)\n    if (stock.gf.DE)\n      data.description = stock.gf.DE.join(\"\\n\")\n    if (stock.gf.NH && !data.newick)  // did the Stockholm alignment include a tree?\n      data.newick = stock.gf.NH.join('')\n    if (stock.gs.DR && !config.structure.noRemoteStructures)  // did the Stockholm alignment include links to PDB?\n      Object.keys(stock.gs.DR).forEach ((node) => {\n        const seqCoords = data.seqCoords[node], seqLen = seqCoords.endPos - seqCoords.startPos\n        stock.gs.DR[node].forEach ((dr) => {\n          const match = this.pdbRegex.exec(dr)\n          if (match) {\n            const pdb = match[1].toLowerCase(), chain = match[2], startPos = parseInt (match[3]), endPos = parseInt (match[4])\n            const pdbLen = endPos - startPos\n            if (seqLen === pdbLen) {  // check structure matches sequence\n              structure[node] = structure[node] || []\n              const pdbIndex = structure[node].findIndex ((s) => s.pdb === pdb)\n              let pdbStruct\n              if (pdbIndex < 0) {\n                pdbStruct = { pdb,\n                              chains: [] }\n                structure[node].push (pdbStruct)\n              } else\n                pdbStruct = structure[node][pdbIndex]\n              pdbStruct.chains.push ({ chain,\n                                       startPos,\n                                       endPos })\n            } else\n              console.warn ('ignoring structure ' + pdb + ' (' + startPos + '...' + endPos + ') since it is not a full-length match to ' + node + ' (' + pdbLen + '!=' + seqLen + ')')\n          }\n        })\n      })\n  }\n  \n  componentDidMount() {\n    this.divRef.current.addEventListener ('dragover', this.handleDragOver.bind(this), false)\n    this.divRef.current.addEventListener ('dragenter', this.handleDragEnter.bind(this), false)\n    this.divRef.current.addEventListener ('drop', this.handleDrop.bind(this), false)\n    this.initDataset()\n  }\n\n  componentWillUnmount() {\n    this.divRef.current.removeEventListener ('dragover', this.handleDragOver.bind(this), false)\n    this.divRef.current.removeEventListener ('dragenter', this.handleDragEnter.bind(this), false)\n    this.divRef.current.removeEventListener ('drop', this.handleDrop.bind(this))\n  }\n\n  componentDidUpdate() {\n    this.reconstructMissingNodes()\n  }\n\n  async initDataset() {\n    if (this.props.stockholm)\n      this.addDatasets (this.props.stockholm, false)\n    if (this.props.dataurl)\n      await fetch(this.makeURL (this.props.dataurl))\n      .then (async (res) => {\n        if (res.ok)\n          this.addDatasets (await res.text(), false)\n      })\n    if (this.props.data || this.state.datasets.length)\n      this.setDataset (this.props.data || this.state.datasets[0])\n  }\n  \n  reconstructMissingNodes() {\n    // check if any nodes are missing; if so, do ancestral sequence reconstruction\n    const { data } = this.state\n    let promise\n    if (data) {\n      const { branches } = data\n      let rowData = extend ({}, data.rowData)\n      const missingAncestors = data.branches.filter ((b) => typeof(rowData[b[0]]) === 'undefined').length\n      if (missingAncestors && !this.state.reconstructingAncestors) {\n        this.setState ({ reconstructingAncestors: true })\n        if (window.Worker) {\n          console.warn ('Reconstructing ancestral sequences in web worker...')\n          let instance = getAncestralReconstructionWorker()\n          promise = instance.getAncestralReconstruction ({ branches, rowData, id: this.state.datasetID })\n            .then ((result) => {\n              console.warn ('Ancestral sequence reconstruction complete')\n              if (result.id === this.state.datasetID)\n                this.incorporateAncestralReconstruction (result.ancestralRowData)\n              else\n                console.warn ('Discarding unused ancestral sequence reconstruction')  // guard against bug where ancestral reconstruction comes in after dataset has been changed\n            })\n        } else {\n          console.warn ('Reconstructing ancestral sequences...')\n          promise = getAncestralReconstruction ({ branches, rowData })\n            .then ((result) => {\n              this.incorporateAncestralReconstruction (result.ancestralRowData)\n            })\n        }\n      }\n    } else\n      promise = Promise.resolve()\n    return promise\n  }\n\n  fn2workerURL (fn) {\n    const blob = new Blob(['('+fn.toString()+')()'], {type: 'application/javascript'})\n    return URL.createObjectURL(blob)\n  }\n  \n  incorporateAncestralReconstruction (ancestralRowData) {\n    const { data } = this.state\n    const rowData = extend ({}, data.rowData, ancestralRowData)\n    extend (data, { rowData })\n    this.setDataset (data)  // rebuilds indices\n  }\n\n  defaultColorScheme() { return 'maeditor' }\n  defaultConfig() {\n    return {\n      treeAlignHeight: 400,\n      genericRowHeight: 24,\n      nameFontSize: 12,\n      containerHeight: '100%',\n      containerWidth: '100%',\n      treeWidth: 200,\n      nameDivWidth: 200,\n      branchStrokeStyle: 'black',\n      nodeHandleRadius: 4,\n      nodeHandleClickRadius: 40,\n      nodeHandleFillStyle: 'white',\n      collapsedNodeHandleFillStyle: 'black',\n      rowConnectorDash: [2,2],\n      structure: { width: 400, height: 400 },\n      handler: {},\n      colorScheme: this.defaultColorScheme()\n    } }\n\n  // method to parse FASTA (simple enough to build in here)\n  parseFasta (fasta) {\n    let seq = {}, name, re = /^>(\\S+)/;\n    fasta.split(\"\\n\").forEach ((line) => {\n      const match = re.exec(line)\n      if (match)\n        seq[name = match[1]] = ''\n      else if (name)\n        seq[name] = seq[name] + line.replace(/[ \\t]/g,'')\n    })\n    return seq\n  }\n\n  // index tree\n  buildTreeIndex (data) {\n    const { branches } = data\n    let { root } = data, rootSpecified = typeof(root) !== 'undefined'\n    const roots = this.getRoots (branches)\n    if (roots.length === 0 && (branches.length > 0 || !rootSpecified))\n      throw new Error (\"No root nodes\")\n    if (rootSpecified) {\n      if (roots.indexOf(root) < 0)\n        throw new Error (\"Specified root node is not a root\")\n    } else {\n      if (roots.length !== 1)\n        throw new Error (\"Multiple possible root nodes, and no root specified\")\n      root = roots[0]\n    }\n    let children = {}, branchLength = {}\n    children[root] = []\n    branchLength[root] = 0\n    branches.forEach ((branch) => {\n      const parent = branch[0], child = branch[1], len = branch[2]\n      children[parent] = children[parent] || []\n      children[child] = children[child] || []\n      children[parent].push (child)\n      branchLength[child] = len\n    })\n    let nodes = [], seenNode = {}, descendants = {}, distFromRoot = {}, maxDistFromRoot = 0\n    const addNode = (node) => {\n      if (!node)\n        throw new Error (\"All nodes must be named\")\n      if (seenNode[node])\n        throw new Error (\"All node names must be unique (duplicate '\" + node + \"')\")\n      seenNode[node] = true\n      nodes.push (node)\n    }\n    const addSubtree = (node, parent) => {\n      distFromRoot[node] = (typeof(parent) !== 'undefined' ? distFromRoot[parent] : 0) + branchLength[node]\n      maxDistFromRoot = Math.max (maxDistFromRoot, distFromRoot[node])\n      const kids = children[node]\n      let clade = []\n      if (kids.length === 2) {\n        clade = clade.concat (addSubtree (kids[0], node))\n        addNode (node)\n        clade = clade.concat (addSubtree (kids[1], node))\n      } else {\n        addNode (node)\n        kids.forEach ((child) => clade = clade.concat (addSubtree (child, node)))\n      }\n      descendants[node] = clade\n      return [node].concat (clade)\n    }\n    addSubtree (root)\n    return { root, branches, children, descendants, branchLength, nodes, distFromRoot, maxDistFromRoot }\n  }\n\n  // get the root node(s) of a list of [parent,child,length] branches\n  getRoots (branches) {\n    const isNode = {}, hasParent = {}\n    branches.forEach ((branch) => {\n      const [p, c] = branch\n      isNode[p] = isNode[c] = hasParent[c] = true\n    })\n    return Object.keys(isNode).filter ((n) => !hasParent[n]).sort()\n  }\n\n  // index alignment\n  buildAlignmentIndex (data) {\n    const { rowData } = data\n    let rowDataAsArray = {}, alignColToSeqPos = {}, seqPosToAlignCol = {}, isChar = {}, columns\n    Object.keys(rowData).forEach ((node) => {\n      const row = rowData[node]\n      if (typeof(columns) !== 'undefined' && columns !== row.length)\n        console.error (\"Inconsistent row lengths\")\n      columns = row.length\n      let pos2col = [], pos = 0\n      const rowAsArray = this.rowAsArray (row)\n      alignColToSeqPos[node] = rowAsArray.map ((c, col) => {\n        if (typeof(c) === 'string')\n          isChar[c] = true\n        const isGap = this.isGapChar(c)\n        if (!isGap)\n          pos2col.push (col)\n        return isGap ? pos : pos++\n      })\n      rowDataAsArray[node] = rowAsArray\n      seqPosToAlignCol[node] = pos2col\n    })\n    const chars = Object.keys(isChar).sort()\n    return { alignColToSeqPos, seqPosToAlignCol, rowDataAsArray, columns, chars }\n  }\n\n  // helpers to recognize gap characters\n  isGapChar (c) { return typeof(c) === 'string' ? (c === '-' || c === '.') : (!c || Object.keys(c).length === 0) }\n  countNonGapChars (seq) { return this.rowAsArray(seq).filter ((c) => !this.isGapChar(c)).length }\n  rowAsArray (row) { return typeof(row) === 'string' ? row.split('') : row }\n  \n  render() {\n    return (\n        <div className=\"App\"\n      ref={this.divRef}\n        >\n\n        <div className=\"MSA-appbar\">\n\n        <input type='file'\n      ref={this.inputRef}\n      onChange={this.handleSelectFile.bind(this)}\n      style={{display:'none'}}\n        />\n        \n      { (this.state.data\n         ? (this.state.datasets.length\n            ? ((<Select\n                value={this.state.data.name}\n                onChange={this.handleSelectDataset.bind(this)}\n                >\n                {this.state.datasets.map ((data) => (<MenuItem key={data.name} value={data.name}>{data.name}</MenuItem>))}\n                <MenuItem value=''><i>Open alignment file</i></MenuItem>\n                </Select>\n               ))\n            : (<div className=\"MSA-appbar-title\">\n               {this.state.data.name}\n               </div>))\n         : '')}\n      \n      { (this.state.data && this.state.data.description\n         ? (<div className=\"MSA-appbar-description\">\n            {this.state.data.description}\n            </div>)\n         : '')}\n\n      </div>\n\n      { this.state.data &&\n        <MSA\n        ref={this.msaRef}\n        data={this.state.data}\n        isGapChar={this.isGapChar.bind(this)}\n        config={this.state.config}\n        view={this.state.view}\n        treeIndex={this.state.treeIndex}\n        alignIndex={this.state.alignIndex}\n        computedTreeConfig={this.state.computedTreeConfig}\n        computedFontConfig={this.state.computedFontConfig}\n        /> }\n\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nconst opts = {\n  dataurl: '%PUBLIC_URL%/pfam-cov2.stock',\n  config: {\n    containerHeight: '1000px',\n    handler: {\n      click: (coords) => {\n        console.warn ('Click ' + coords.node + ' column ' + coords.column + (coords.isGap ? '' : (', position ' + coords.seqPos)) + ' (' + coords.c + ')')\n      }\n    }\n  }\n}\n\nReactDOM.render(\n  <React.StrictMode>\n    <App {...opts} />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","\n\t\t\t\tvar addMethods = require(\"../node_modules/workerize-loader/dist/rpc-wrapper.js\")\n\t\t\t\tvar methods = [\"getAncestralReconstruction\"]\n\t\t\t\tmodule.exports = function() {\n\t\t\t\t\tvar w = new Worker(__webpack_public_path__ + \"49e0c98df6571801ee9b.worker.js\", { name: \"[hash].worker.js\" })\n\t\t\t\t\taddMethods(w, methods)\n\t\t\t\t\t\n\t\t\t\t\treturn w\n\t\t\t\t}\n\t\t\t"],"sourceRoot":""}