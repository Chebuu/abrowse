(this.webpackJsonpabrowse=this.webpackJsonpabrowse||[]).push([[0],{104:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(10),i=n.n(o),s=(n(79),n(69)),l=n(17),c=n.n(l),u=n(25),h=n(12),d=n(13),f=n(14),p=n(15),v=n(134),m=n(137),g=n(8),y={clustal:{G:"orange",P:"orange",S:"orange",T:"orange",H:"red",K:"red",R:"red",F:"blue",W:"blue",Y:"blue",I:"green",L:"green",M:"green",V:"green"},lesk:{G:"orange",A:"orange",S:"orange",T:"orange",C:"green",V:"green",I:"green",L:"green",P:"green",F:"green",Y:"green",M:"green",W:"green",N:"magenta",Q:"magenta",H:"magenta",D:"red",E:"red",K:"blue",R:"blue"},maeditor:{A:"lightgreen",G:"lightgreen",C:"green",D:"darkgreen",E:"darkgreen",N:"darkgreen",Q:"darkgreen",I:"blue",L:"blue",M:"blue",V:"blue",F:"#c8a2c8",W:"#c8a2c8",Y:"#c8a2c8",H:"darkblue",K:"orange",R:"orange",P:"pink",S:"red",T:"red"},cinema:{H:"blue",K:"blue",R:"blue",D:"red",E:"red",S:"green",T:"green",N:"green",Q:"green",A:"white",V:"white",L:"white",I:"white",M:"white",F:"magenta",W:"magenta",Y:"magenta",P:"brown",G:"brown",C:"yellow",B:"gray",Z:"gray",X:"gray","-":"gray",".":"gray"}},b=(n(82),n(39)),w=n.n(b),k=function(){var e=Object(u.a)(c.a.mark((function e(t){var n,r,a,o,i,s,l,u,h;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.branches,r=t.rowData,a=t.id,o=(o=t.gapChar)||"-",i={},20,s=Math.log(20)/Math.log(2),.001,l=w.a.models.makeGappedModel({model:w.a.models[w.a.defaultModel],deletionRate:.001,gapChar:o}),u=w.a.getNodePostProfiles({branchList:n,nodeSeq:r,postProbThreshold:.01,model:l,defaultGapChar:o}),h=u.nodeProfile,Object.keys(h).forEach((function(e){i[e]=h[e].map((function(e){if(e[o]>=.5)return o;var t=Object.keys(e).filter((function(e){return e!==o})).sort((function(t,n){return e[t]-e[n]})),n=t.reduce((function(t,n){return t+e[n]}),0),r=t.map((function(t){return e[t]/n})),a=r.reduce((function(e,t){return e-t*Math.log(t)}),0)/Math.log(2);return t.map((function(e,t){return[e,r[t]*(s-a)/s]}))}))})),e.abrupt("return",{id:a,ancestralRowData:i});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=n(60),C=n.n(S),M=n(49),R=n.n(M),E=n(61),x=n(62),D=n.n(x),A=n(63),L=n.n(A),O=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).canvasRef=a.a.createRef(),r}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props.computedTreeConfig.treeWidth,t=this.props.treeLayout.treeHeight;return a.a.createElement("div",{className:"MSA-tree",style:{minWidth:e}},a.a.createElement("canvas",{className:"MSA-tree-canvas",ref:this.canvasRef,width:e,height:t,style:{top:-this.props.scrollTop}}))}},{key:"componentDidMount",value:function(){this.renderTree(),this.canvasRef.current.addEventListener("click",this.handleClick.bind(this))}},{key:"componentWillUnmount",value:function(){this.canvasRef.current.removeEventListener("click",this.handleClick.bind(this))}},{key:"componentDidUpdate",value:function(){this.renderTree()}},{key:"renderTree",value:function(){var e=this.props,t=e.treeIndex,n=e.treeLayout,r=e.computedView,a=e.computedTreeConfig,o=r.collapsed,i=r.ancestorCollapsed,s=r.forceDisplayNode,l=r.nodeScale,c=a.treeWidth,u=a.branchStrokeStyle,h=a.treeStrokeWidth,d=a.rowConnectorDash,f=a.nodeHandleRadius,p=a.nodeHandleFillStyle,v=a.collapsedNodeHandleFillStyle,m=n.nx,g=n.ny,y=this.canvasRef.current,b=y.getContext("2d");b.setTransform(1,0,0,1,0,0),b.globalAlpha=1,b.clearRect(0,0,y.width,y.height),b.strokeStyle=u,b.fillStyle=u,b.lineWidth=h;var w=function(e){var t=l[e];b.globalAlpha="undefined"===typeof t||s[e]?1:t},k=t.nodes.filter((function(e){return!i[e]&&t.children[e].length}));t.nodes.forEach((function(e){i[e]||(t.children[e].length||(w(e),b.setLineDash([]),b.beginPath(),b.fillRect(m[e],g[e]-f,1,2*f)),t.children[e].length&&!o[e]&&(b.setLineDash([]),t.children[e].forEach((function(t){w(t),b.beginPath(),b.moveTo(m[e],g[e]),b.lineTo(m[e],g[t]),b.lineTo(m[t],g[t]),b.stroke()}))),b.globalAlpha=1,(0===t.children[e].length||s[e])&&(w(e),b.setLineDash(d),b.beginPath(),b.moveTo(m[e],g[e]),b.lineTo(c,g[e]),b.stroke()))})),b.strokeStyle=u,b.setLineDash([]),k.forEach((function(e){w(e),function(e){b.beginPath(),b.arc(m[e],g[e],f,0,2*Math.PI)}(e),o[e]||s[e]&&!1!==o[e]?b.fillStyle=v:(b.fillStyle=p,b.stroke()),b.fill()})),this.nodesWithHandles=k}},{key:"handleClick",value:function(e){e.preventDefault();var t,n,r=this.props.treeLayout,a=parseInt(e.offsetX),o=parseInt(e.offsetY);this.nodesWithHandles.forEach((function(e){var i=Math.pow(a-r.nx[e],2)+Math.pow(o-r.ny[e],2);("undefined"===typeof n||i<n)&&(n=i,t=e)})),t&&n<=Math.pow(this.props.config.nodeHandleClickRadius,2)&&this.props.handleNodeClick(t)}}]),n}(r.Component),T=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.data,r=t.computedFontConfig,o=t.treeIndex,i=t.config,s=t.computedView,l=t.treeLayout,c=n.structure||{},u=i.nameDivWidth,h=r.nameFontName,d=r.nameFontSize,f=l.nodeHeight;return a.a.createElement("div",{className:"MSA-alignment-names",style:{fontFamily:h,fontSize:d+"px",maxWidth:u}},a.a.createElement("div",{className:"MSA-alignment-names-content",style:{top:-this.props.scrollTop}},o.nodes.filter((function(e){return s.nodeVisible[e]})).map((function(t,n){var r={height:f[t]+"px"},o=e.props.view.nodeScale[t];return"undefined"!==typeof o&&1!==o&&(r.transform="scale(1,"+o+")",r.opacity=o),a.a.createElement("div",{className:"MSA-alignment-name",key:t,style:r},c[t]?a.a.createElement("span",{className:"MSA-alignment-name-link",onClick:function(){return e.props.handleNameClick(t)},style:{fontFamily:h,fontSize:d+"px"}},t):a.a.createElement("span",null," ",t," "))}))))}}]),n}(r.Component),j=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={clientWidth:0,clientHeight:0},r.canvasRef=a.a.createRef(),r}return Object(d.a)(n,[{key:"render",value:function(){var e=this.getDimensions(),t=e.top,n=e.left,r=e.width,o=e.height;return a.a.createElement("canvas",{ref:this.canvasRef,className:"MSA-alignment-canvas",width:r,height:o,style:{top:t,left:n}})}},{key:"getColor",value:function(e){var t=this.props.computedFontConfig.color;return t[e.toUpperCase()]||t.default||"black"}},{key:"getOffscreenRatio",value:function(){return 1}},{key:"getDimensions",value:function(){var e=this.props,t=e.scrollLeft,n=e.scrollTop,r=this.state,a=r.clientWidth,o=r.clientHeight,i=this.getOffscreenRatio(),s=i*a,l=i*o,c=Math.max(0,n-l),u=Math.max(0,t-s),h=Math.min(this.props.treeLayout.treeHeight,n+o+l),d=Math.min(this.props.alignLayout.alignWidth,t+a+s);return{top:c,left:u,bottom:h,right:d,width:d-u,height:h-c}}},{key:"setClientSize",value:function(e,t){e===this.state.clientWidth&&t===this.state.clientHeight||this.setState({clientWidth:e,clientHeight:t})}},{key:"componentDidMount",value:function(){this.renderVisibleRegion()}},{key:"componentDidUpdate",value:function(){this.renderVisibleRegion()}},{key:"renderVisibleRegion",value:function(){var e,t,n=this,r=this.canvasRef.current,a=r.getContext("2d"),o=this.getDimensions(),i=o.top,s=o.left,l=o.bottom,c=o.right,u=this.props,h=u.computedFontConfig,d=u.treeLayout,f=u.alignLayout,p=u.treeIndex,v=u.alignIndex,m=u.data.rowData;a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,a.clearRect(0,0,r.width,r.height),a.font=h.charFont;for(var g=e=0;g<d.rowHeight.length&&d.rowY[g]<l;++g)d.rowY[g]<i&&(e=g),t=g;for(var y=function(r){var o=f.computedColScale[r],l=f.colX[r],c=f.colWidth[r];if(o&&l+c>=s)for(var u=function(e){var t=d.computedRowScale[e],c=d.rowY[e],u=d.rowHeight[e],h=m[p.nodes[e]];if(u&&h){a.globalAlpha=Math.min(o,t);var f=h[r];if("string"===typeof f)a.setTransform(o,0,0,t,l-s,c+u-i),a.fillStyle=n.getColor(f),a.fillText(f,0,0);else{var v=0;f.forEach((function(e){var r=e[0],h=e[1];a.setTransform(o,0,0,t*h,l-s,c+u*(1-v)-i),a.fillStyle=n.getColor(r),a.fillText(r,0,0),v+=h}))}}},h=e;h<=t;++h)u(h)},b=0;b<v.columns&&0<c;++b)y(b)}}]),n}(r.Component),F=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).rowsDivRef=a.a.createRef(),r.alignCanvasRef=a.a.createRef(),r}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props.treeLayout.treeHeight,t=this.props.alignLayout.alignWidth;return a.a.createElement("div",{className:"MSA-alignment-rows",ref:this.rowsDivRef,onClick:this.handleClick.bind(this),onMouseMove:this.handleMouseMove.bind(this),onMouseLeave:this.handleMouseLeave.bind(this),onMouseDown:this.handleMouseDown.bind(this),onScroll:this.handleScroll.bind(this)},a.a.createElement(j,{ref:this.alignCanvasRef,data:this.props.data,treeIndex:this.props.treeIndex,alignIndex:this.props.alignIndex,treeLayout:this.props.treeLayout,alignLayout:this.props.alignLayout,computedFontConfig:this.props.computedFontConfig,scrollLeft:this.props.scrollLeft,scrollTop:this.props.scrollTop}),null!==this.props.hoverColumn?a.a.createElement("div",{className:"MSA-alignment-column-cursor",style:{left:this.props.alignLayout.colX[this.props.hoverColumn],top:0,width:this.props.alignLayout.colWidth[this.props.hoverColumn],height:this.props.treeLayout.treeHeight}}):"",a.a.createElement("div",{className:"MSA-alignment-rows-back",style:{width:t,height:e}}))}},{key:"componentDidUpdate",value:function(){this.setScrollPos(),this.setClientSize()}},{key:"componentDidMount",value:function(){this.setScrollPos(),this.setClientSize(),window.addEventListener("resize",this.setClientSize.bind(this))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.setClientSize.bind(this))}},{key:"setClientSize",value:function(){this.props.setClientSize(this.rowsDivRef.current.clientWidth,this.rowsDivRef.current.clientHeight),this.alignCanvasRef.current.setClientSize(this.rowsDivRef.current.clientWidth,this.rowsDivRef.current.clientHeight)}},{key:"setScrollPos",value:function(e){e=e||this.props,this.rowsDivRef.current.scrollLeft=e.scrollLeft,this.rowsDivRef.current.scrollTop=e.scrollTop}},{key:"handleClick",value:function(e){this.props.handleAlignCharClick(this.resolveAlignCoords(e))}},{key:"handleMouseMove",value:function(e){var t=this.resolveAlignCoords(e);this.lastCoords&&t.row===this.lastCoords.row&&t.column===this.lastCoords.column||(this.props.handleAlignCharMouseOut(this.lastCoords),this.props.handleAlignCharMouseOver(t),this.lastCoords=t)}},{key:"handleMouseLeave",value:function(e){this.props.handleMouseLeave(e)}},{key:"handleMouseDown",value:function(e){this.props.handleMouseDown(e)}},{key:"handleScroll",value:function(e){this.props.handleScroll(this.rowsDivRef.current.scrollLeft,this.rowsDivRef.current.scrollTop)}},{key:"resolveAlignCoords",value:function(e){var t,n,r=this.props,a=r.treeIndex,o=r.alignIndex,i=r.treeLayout,s=r.alignLayout,l=r.data.rowData,c=parseInt(e.nativeEvent.offsetX),u=parseInt(e.nativeEvent.offsetY);for(t=0;t<a.nodes.length-1&&!(i.rowY[t]<=u&&i.rowY[t]+i.rowHeight[t]>u);++t);for(n=0;n<o.columns-1&&!(s.colX[n]<=c&&s.colX[n]+s.colWidth[n]>c);++n);var h=a.nodes[t],d=o.alignColToSeqPos[h],f=d&&d[n],p=l[h],v=p&&p[n];return{row:t,column:n,node:h,seqPos:f,c:v,isGap:this.props.isGapChar(v)}}}]),n}(r.Component),I=n(33),H=n.n(I),N=n(138),P=n(136),W=n(68),V=n.n(W),q=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).pvDivRef=a.a.createRef(),r}return Object(d.a)(n,[{key:"render",value:function(){var e=Object(g.isArray)(this.props.structure.structureInfo),t=!e&&this.props.structure.structureInfo.pdb;return a.a.createElement("div",{className:"MSA-structure",style:{width:this.props.config.width,height:this.props.config.height}},a.a.createElement("div",{className:"MSA-structure-name"},this.props.structure.node),t&&a.a.createElement("div",{className:"MSA-structure-label"},t),a.a.createElement("div",{className:"MSA-structure-top"},e&&a.a.createElement(v.a,{value:"",displayEmpty:!0,onChange:this.handleSelectStructure.bind(this)},a.a.createElement(m.a,{value:"",disabled:!0},"Select a structure"),this.props.structure.structureInfo.map((function(e,t){return a.a.createElement(m.a,{key:t,value:e},e.pdb)}))),a.a.createElement("div",{className:"MSA-structure-close-button"},a.a.createElement(V.a,{onClick:this.handleClose.bind(this)}))),a.a.createElement("div",{className:"MSA-structure-pv",ref:this.pvDivRef}))}},{key:"getPvConfig",value:function(e){var t=e.width,n=e.height;return e.pvConfig||{width:t,height:n,antialias:!0,quality:"medium"}}},{key:"pdbUrlPrefix",value:function(){return"https://files.rcsb.org/download/"}},{key:"pdbUrlSuffix",value:function(){return".pdb"}},{key:"componentDidMount",value:function(){this.updatePv()}},{key:"componentDidUpdate",value:function(){this.updatePv()}},{key:"updatePv",value:function(){Object(g.isArray)(this.props.structure.structureInfo)||this.loadStructure()}},{key:"handleSelectStructure",value:function(e){this.props.updateStructure({structureInfo:e.target.value})}},{key:"loadStructure",value:function(){var e=this;if(!this.props.structure.pdbFetchInitiated){this.props.updateStructure({pdbFetchInitiated:!0});var t=this.props.config,n=this.getPvConfig(t),r=H.a.Viewer(this.pvDivRef.current,n),a=!t.noRemoteStructures,o=(a?this.pdbUrlPrefix():t.pdbPrefix||"")+this.props.structure.structureInfo.pdb+(a?this.pdbUrlSuffix():t.pdbSuffix||"");H.a.io.fetchPdb(o,(function(t){e.props.updateStructure({pdb:t,viewer:r}),e.props.setViewType(),r.centerOn(t),r.autoZoom(),e.pvDivRef.current.addEventListener("mousemove",(function(t){var n=r.boundingClientRect(),a=r.pick({x:t.clientX-n.left,y:t.clientY-n.top});if(a){var o=a.target().residue(),i=o.num(),s=o.chain().name();e.props.handleMouseoverResidue(s,i)}else e.props.handleMouseoverResidue(null,null)})),e.pvDivRef.current.addEventListener("mouseleave",(function(t){e.props.handleMouseoverResidue(null,null)}))}))}}},{key:"handleClose",value:function(e){e.preventDefault(),this.props.handleCloseStructure(this.props.structure)}}]),n}(r.Component),U=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={config:r.props.initConfig,viewMode:"cartoon",colorScheme:"ssSuccession"},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this;return this.props.structures.length?a.a.createElement("div",{className:"MSA-structure-panel"},a.a.createElement("div",{className:"MSA-structure-controls"},a.a.createElement(v.a,{value:this.state.viewMode,onChange:this.handleSelectViewType.bind(this)},a.a.createElement(m.a,{value:"cartoon"},"Cartoons"),a.a.createElement(m.a,{value:"tube"},"Tube"),a.a.createElement(m.a,{value:"spheres"},"Spheres"),a.a.createElement(m.a,{value:"ballsAndSticks"},"Balls and sticks")),a.a.createElement(v.a,{value:this.state.colorScheme,onChange:this.handleSelectColorScheme.bind(this)},a.a.createElement(m.a,{value:"uniform"},"Uniform"),a.a.createElement(m.a,{value:"byChain"},"Chain"),a.a.createElement(m.a,{value:"bySS"},"Secondary structure"),a.a.createElement(m.a,{value:"ssSuccession"},"Secondary structure gradient"),a.a.createElement(m.a,{value:"rainbow"},"Rainbow")),a.a.createElement(N.a,{control:a.a.createElement(P.a,{checked:this.state.config.showMouseoverLabel,onChange:this.handleMouseoverLabelConfig.bind(this)}),label:"Show label on hover"})),a.a.createElement("div",{className:"MSA-structures"},this.props.structures.map((function(t){return a.a.createElement(q,{key:t.key,structure:t,config:e.state.config,setViewType:function(){return e.setViewType(t)},updateStructure:function(n){return e.props.updateStructure(t,n)},handleCloseStructure:e.props.handleCloseStructure,handleMouseoverResidue:function(n,r){return e.props.handleMouseoverResidue(t,n,r)}})})))):""}},{key:"handleMouseoverLabelConfig",value:function(e){var t=this.state.config;t.showMouseoverLabel=e.target.checked,this.setState({config:t})}},{key:"redrawStructureDelay",value:function(){return 500}},{key:"setViewType",value:function(e,t,n){var r=this;t=t||this.state.viewMode,n=n||this.state.colorScheme;var a=e.pdb,o=e.viewer;if(o){o.clear();var i=o.renderAs("protein",a,t,{color:H.a.color[n]()});this.props.updateStructure(e,{geometry:i})}this.props.structures.forEach((function(e){r.props.updateStructure(e,{trueAtomColor:{}})})),this.requestRedrawStructures()}},{key:"handleSelectViewType",value:function(e){var t=this,n=e.target.value;this.setState({viewMode:n}),this.props.structures.forEach((function(e){return t.setViewType(e,n)}))}},{key:"handleSelectColorScheme",value:function(e){var t=this,n=e.target.value;this.setState({colorScheme:n}),this.props.structures.forEach((function(e){return t.setViewType(e,void 0,n)}))}},{key:"addLabelToStructuresOnMouseover",value:function(e){var t=this,n=this.state.config.label||{font:"sans-serif",fontSize:12,fontColor:"#f62",fillStyle:"white",backgroundAlpha:.4},r=this.state.config.atomHighlightColor||"red";this.props.structures.forEach((function(a){var o=t.props.alignIndex.alignColToSeqPos[a.node];if(o){var i=o[e];t.removeMouseoverLabels(a),Object(g.isArray)(a.structureInfo)||a.structureInfo.chains.forEach((function(e){var o=i+e.startPos;if(!e.endPos||o<=e.endPos){var s=e.chain,l=a.pdb.residueSelect((function(e){return e.num()===o&&("undefined"===typeof s||e.chain().name()===s)}));l&&l.eachResidue((function(e){var o="mouseover"+(a.mouseoverLabel.length+1);t.state.config.showMouseoverLabel&&a.viewer.label(o,e.qualifiedName(),e.centralAtom().pos(),n),e.atoms().forEach((function(e){if(!a.trueAtomColor[e.index()]){var t=[0,0,0,0];a.geometry.getColorForAtom(e,t),a.trueAtomColor[e.index()]=t}})),t.setColorForAtoms(a.geometry,e.atoms(),r),a.mouseoverLabel.push({label:o,res:e})}))}}))}})),this.requestRedrawStructures()}},{key:"removeLabelFromStructuresOnMouseout",value:function(){var e=this;this.props.structures.forEach((function(t){e.removeMouseoverLabels(t)})),this.requestRedrawStructures()}},{key:"removeMouseoverLabels",value:function(e){var t=this;e.mouseoverLabel.forEach((function(n){t.state.config.showMouseoverLabel&&e.viewer.rm(n.label);var r={};n.res.atoms().forEach((function(t){var n=e.trueAtomColor[t.index()],a=n.toString();r[a]=r[a]||{trueColor:n,atoms:[]},r[a].atoms.push(t)})),Object.keys(r).forEach((function(n){return t.setColorForAtoms(e.geometry,r[n].atoms,r[n].trueColor)}))})),e.mouseoverLabel=[]}},{key:"setColorForAtoms",value:function(e,t,n){var r=e.structure().createEmptyView();t.forEach((function(e){return r.addAtom(e)})),e.colorBy(H.a.color.uniform(n),r)}},{key:"requestRedrawStructures",value:function(){var e=this;this.props.setTimer("redraw",this.redrawStructureDelay(),(function(){e.props.structures.filter((function(e){return e.viewer})).forEach((function(e){return e.viewer.requestRedraw()}))}))}}]),n}(r.Component),Y=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;Object(h.a)(this,n),r=t.call(this,e);var o=Object(g.extend)(r.initialView(),e.view||{});return r.state=Object(g.extend)({scrollTop:0,alignScrollLeft:0,hoverColumn:null},{view:o}),r.rowsRef=a.a.createRef(),r.msaRef=a.a.createRef(),r.structRef=a.a.createRef(),r}return Object(d.a)(n,[{key:"initialView",value:function(){return{collapsed:{},forceDisplayNode:{},nodeScale:{},columnScale:{},disableTreeEvents:!1,animating:!1,structure:{openStructures:[]}}}},{key:"collapseAnimationFrames",value:function(){return 10}},{key:"collapseAnimationDuration",value:function(){return 200}},{key:"collapseAnimationMaxFrameSkip",value:function(){return 8}},{key:"mouseoverLabelDelay",value:function(){return 100}},{key:"resetView",value:function(){this.setState({view:this.initialView()})}},{key:"getComputedView",value:function(e){var t=this;e=e||this.state.view;var n=this.props,r=n.treeIndex,a=n.alignIndex,o=e,i=o.collapsed,s=o.forceDisplayNode,l=a.rowDataAsArray,c={},u={};!function e(t,n){c[t]=c[n]||i[n];var a=r.children[t];a&&a.forEach((function(n){return e(n,t)}))}(r.root),r.nodes.forEach((function(e){return u[e]=!c[e]&&(0===r.children[e].length||s[e])}));var h=new Array(a.columns).fill(!1);return r.nodes.filter((function(e){return u[e]})).forEach((function(e){l[e]&&l[e].forEach((function(e,n){t.props.isGapChar(e)||(h[n]=!0)}))})),Object(g.extend)({ancestorCollapsed:c,nodeVisible:u,columnVisible:h},e)}},{key:"layoutTree",value:function(e){var t=this.props,n=t.computedTreeConfig,r=t.treeIndex,a=e.nodeVisible,o=e.nodeScale,i=n.genericRowHeight,s=n.nodeHandleRadius,l=n.treeStrokeWidth,c=n.availableTreeWidth,u={},h={},d=[],f={},p=[],v=0,m=r.nodes.map((function(e){var t="undefined"!==typeof o[e]?o[e]:1,n=t*(a[e]?i:0),m=v;return u[e]=s+l+c*r.distFromRoot[e]/r.maxDistFromRoot,h[e]=m+n/2,f[e]=n,d.push(t),p.push(n),v+=n,m}));return{nx:u,ny:h,computedRowScale:d,nodeHeight:f,rowHeight:p,rowY:m,treeHeight:v,computedView:e}}},{key:"layoutAlignment",value:function(e){var t=this,n=this.props,r=n.alignIndex,a=n.computedFontConfig,o=a.genericRowHeight,i=a.charFont,s=r.chars,l=0,c={};s.forEach((function(e){var n=t.create("canvas",null,null,{width:o,height:o}).getContext("2d");n.font=i,c[e]=n.measureText(e),l=Math.max(l,Math.ceil(c[e].width))}));for(var u=o,h=0,d=[],f=[],p=[],v=0;v<r.columns;++v)if(d.push(h),e.columnVisible[v]){var m=e.columnScale[v];"undefined"===typeof m&&(m=1),p.push(m);var g=m*l;f.push(g),h+=g}else p.push(0),f.push(0);return{charMetrics:c,charWidth:l,charHeight:u,colX:d,colWidth:f,computedColScale:p,alignWidth:h}}},{key:"create",value:function(e,t,n,r){var a=document.createElement(e);return t&&t.appendChild(a),r&&Object.keys(r).filter((function(e){return"undefined"!==typeof r[e]})).forEach((function(e){return a.setAttribute(e,r[e])})),n&&(a.style=n),a}},{key:"render",value:function(){var e=this,t=this.getComputedView(),n=this.layoutTree(t),r=this.layoutAlignment(t);return this.treeHeight=n.treeHeight,this.alignWidth=r.alignWidth,a.a.createElement("div",{className:"MSA",style:{width:this.props.config.containerWidth,height:this.props.config.containerHeight}},a.a.createElement("div",{className:"MSA-tree-alignment",ref:this.msaRef,onMouseDown:this.handleMouseDown.bind(this),style:{width:this.props.config.containerWidth,height:n.treeAlignHeight}},a.a.createElement(O,{config:this.props.config,computedTreeConfig:this.props.computedTreeConfig,treeIndex:this.props.treeIndex,treeLayout:n,computedView:t,scrollTop:this.state.scrollTop,handleNodeClick:this.handleNodeClick.bind(this)}),a.a.createElement(T,{data:this.props.data,view:this.state.view,config:this.props.config,computedFontConfig:this.props.computedFontConfig,treeIndex:this.props.treeIndex,alignIndex:this.props.alignIndex,treeLayout:n,alignLayout:r,computedView:t,scrollTop:this.state.scrollTop,handleNameClick:this.handleNameClick.bind(this)}),a.a.createElement(F,{ref:this.rowsRef,data:this.props.data,view:this.state.view,config:this.props.config,computedFontConfig:this.props.computedFontConfig,treeIndex:this.props.treeIndex,alignIndex:this.props.alignIndex,isGapChar:this.props.isGapChar,treeLayout:n,alignLayout:r,setClientSize:this.setAlignmentClientSize.bind(this),handleScroll:this.handleAlignmentScroll.bind(this),handleMouseDown:this.handleAlignmentMouseDown.bind(this),handleAlignCharClick:this.handleAlignCharClick.bind(this),handleAlignCharMouseOver:this.handleAlignCharMouseOver.bind(this),handleAlignCharMouseOut:this.handleAlignCharMouseOut.bind(this),handleMouseLeave:function(){return e.delayedSetHoverColumn(null)},scrollLeft:this.state.alignScrollLeft,scrollTop:this.state.scrollTop,hoverColumn:this.state.hoverColumn})),a.a.createElement(U,{ref:this.structRef,initConfig:this.props.config.structure,alignIndex:this.props.alignIndex,structures:this.state.view.structure.openStructures,updateStructure:this.updateStructure.bind(this),handleCloseStructure:this.handleCloseStructure.bind(this),handleMouseoverResidue:this.handleMouseoverStructureResidue.bind(this),setTimer:this.setTimer.bind(this)}))}},{key:"componentDidMount",value:function(){window.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),window.addEventListener("mouseup",this.handleMouseUp.bind(this)),window.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.msaRef.current.addEventListener("wheel",this.handleMouseWheel.bind(this),{passive:!1})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mouseleave",this.handleMouseLeave.bind(this)),window.removeEventListener("mouseup",this.handleMouseUp.bind(this)),window.removeEventListener("mousemove",this.handleMouseMove.bind(this)),this.msaRef.current.removeEventListener("wheel",this.handleMouseWheel.bind(this))}},{key:"setAlignmentClientSize",value:function(e,t){this.alignmentClientWidth=e,this.alignmentClientHeight=t}},{key:"handleNameClick",value:function(e){var t=this.props.data.structure;this.nStructs=(this.nStructs||0)+1;var n=t[e];Object(g.isArray)(n)&&1===n.length&&(n=n[0]);var r={node:e,structureInfo:n,startPos:this.props.data.seqCoords[e].startPos,mouseoverLabel:[],trueAtomColor:{},key:this.nStructs},a=this.state.view;a.structure.openStructures.push(r),this.setState({view:a})}},{key:"updateStructure",value:function(e,t){var n=this.state.view;n.structure.openStructures=n.structure.openStructures.map((function(n){return n===e?Object(g.extend)(n,t):n})),this.setState({view:n})}},{key:"handleCloseStructure",value:function(e){var t=this.state.view;t.structure.openStructures=t.structure.openStructures.filter((function(t){return t!==e})),this.setState({view:t})}},{key:"handleNodeClick",value:function(e){var t=this;if(this.scrolling)this.scrolling=!1;else if(!this.state.disableTreeEvents){var n=this.props,r=n.treeIndex,a=n.alignIndex,o=this.getComputedView(),i=o.collapsed,s=o.nodeScale,l=o.columnScale,c=o.forceDisplayNode,u=o.columnVisible,h=this.layoutAlignment(o),d=this.state.alignScrollLeft,f=d+this.alignmentClientWidth,p=this.collapseAnimationFrames(),v=p,m=i[e],y=Object(g.extend)({},i);m?(i[e]=!1,delete y[e]):y[e]=!0;var b=Object(g.extend)({},c);b[e]=!m;for(var w=this.getComputedView({collapsed:y,forceDisplayNode:b}),k=[],S=[],C=[],M=0;M<a.columns;++M){w.columnVisible[M]!==u[M]&&(w.columnVisible[e]?k:S).push(M);var R=h.colX[M],E=h.colWidth[M];u[M]&&w.columnVisible[M]&&R>=d&&R+E<f&&C.push(M)}var x=this.centroidOfColumns(C,h)-this.state.alignScrollLeft,D=Date.now(),A=this.collapseAnimationDuration()/p;!function n(){var a,o,u=i;if(v){var h=(m?p+1-v:v)/(p+1);r.descendants[e].forEach((function(e){s[e]=h})),s[e]=1-h,S.forEach((function(e){return l[e]=h})),k.forEach((function(e){return l[e]=1-h})),c[e]=!0,a=!0,o=!0}else r.descendants[e].forEach((function(e){delete s[e]})),delete s[e],S.forEach((function(e){return delete l[e]})),k.forEach((function(e){return delete l[e]})),c[e]=!m,u=y,a=!1,o=!1;var d=Object(g.extend)({},t.state.view,{collapsed:u,forceDisplayNode:c,nodeScale:s,columnScale:l,disableTreeEvents:a,animating:o}),f=t.getComputedView(d),b=t.layoutAlignment(f),w=t.boundAlignScrollLeft(t.centroidOfColumns(C,b)-x);window.requestAnimationFrame((function(){if(t.setState({alignScrollLeft:w,view:d}),v){var e=Date.now(),r=e-D,a=Math.max(0,A-r),o=Math.min(t.collapseAnimationMaxFrameSkip(),Math.ceil(r/A));v=Math.max(0,v-o),D=e,setTimeout(n,a)}}))}()}}},{key:"handleAlignmentScroll",value:function(e,t){e===this.state.alignScrollLeft&&t===this.state.scrollTop||this.setState({alignScrollLeft:e,scrollTop:t})}},{key:"handleMouseWheel",value:function(e){var t=this;if(0!==e.deltaY){var n=e.deltaY*(e.deltaMode?this.props.config.genericRowHeight:1);e.preventDefault(),this.requestAnimationFrame((function(){t.setState({alignScrollLeft:t.incAlignScrollLeft(e.deltaX),scrollTop:t.incScrollTop(n)})}))}}},{key:"handleMouseDown",value:function(e){this.mouseDown=!0,this.lastY=e.pageY}},{key:"handleAlignmentMouseDown",value:function(e){this.alignMouseDown=!0,this.lastX=e.pageX}},{key:"handleAlignCharClick",value:function(e){!this.panning&&this.scrolling,this.panning=this.scrolling=!1}},{key:"handleAlignCharMouseOver",value:function(e){this.panning||this.scrolling||this.delayedSetHoverColumn(e.column)}},{key:"handleAlignCharMouseOut",value:function(e){!this.panning&&this.scrolling}},{key:"delayedSetHoverColumn",value:function(e){var t=this;this.setMouseoverTimer((function(){t.setHoverColumn(e)}))}},{key:"setMouseoverTimer",value:function(e){this.setTimer("mouseover",this.mouseoverLabelDelay(),(function(){return window.requestAnimationFrame(e)}))}},{key:"setHoverColumn",value:function(e){this.setState({hoverColumn:e}),null===e?this.structRef.current.removeLabelFromStructuresOnMouseout():this.structRef.current.addLabelToStructuresOnMouseover(e)}},{key:"handleMouseoverStructureResidue",value:function(e,t,n){var r=this;this.setMouseoverTimer((function(){var a=r.props.alignIndex.seqPosToAlignCol[e.node],o=e.structureInfo.chains.find((function(e){return e.chain===t}));if(a&&o&&n>=o.startPos&&n<=o.endPos){var i=a[n-o.startPos];r.setHoverColumn(i)}else r.setHoverColumn(null)}))}},{key:"handleMouseLeave",value:function(){this.alignMouseDown=!1,this.mouseDown=!1,this.panning=this.scrolling=!1}},{key:"handleMouseUp",value:function(){this.alignMouseDown=!1,this.mouseDown=!1}},{key:"centroidOfColumns",value:function(e,t){return e.length&&e.reduce((function(e,n){return e+t.colX[n]+t.colWidth[n]/2}),0)/e.length}},{key:"incAlignScrollLeft",value:function(e){return this.boundAlignScrollLeft(this.state.alignScrollLeft+e)}},{key:"incScrollTop",value:function(e){return this.boundScrollTop(this.state.scrollTop+e)}},{key:"boundAlignScrollLeft",value:function(e){return Math.max(0,Math.min(this.alignWidth-this.alignmentClientWidth,e))}},{key:"boundScrollTop",value:function(e){return Math.max(0,Math.min(this.treeHeight-this.alignmentClientHeight,e))}},{key:"handleMouseMove",value:function(e){var t=this;(this.alignMouseDown||this.mousedown)&&e.preventDefault();var n=this.state,r=n.alignScrollLeft,a=n.scrollTop,o=!1;if(this.alignMouseDown){var i=e.pageX-this.lastX;i&&(r=this.incAlignScrollLeft(-i),this.panning=!0,o=!0)}else this.panning=!1;if(this.mouseDown){var s=e.pageY-this.lastY;s&&(a=this.incScrollTop(-s),this.scrolling=!0,o=!0)}else this.scrolling=!1;o&&this.requestAnimationFrame((function(){t.setState({alignScrollLeft:r,scrollTop:a}),t.lastX=e.pageX,t.lastY=e.pageY}))}},{key:"requestAnimationFrame",value:function(e){this.animationTimeout&&window.cancelAnimationFrame(this.animationTimeout),this.animationTimeout=window.requestAnimationFrame(e)}},{key:"setTimer",value:function(e,t,n){var r=this;this.timer=this.timer||{},this.clearTimer(this,e),this.timer[e]=window.setTimeout((function(){delete r.timer[e],n()}),t)}},{key:"clearTimer",value:function(e){this.timer&&this.timer[e]&&(window.clearTimeout(this.timer[e]),delete this.timer[e])}}]),n}(r.Component),z=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;Object(h.a)(this,n),r=t.call(this,e);var o=Object(g.extend)(r.defaultConfig(),e.config||{}),i=o.genericRowHeight,s=o.nameFontSize,l=o.treeWidth,c=o.branchStrokeStyle,u=o.nodeHandleRadius,d={treeWidth:l,availableTreeWidth:l-u-2,genericRowHeight:i,branchStrokeStyle:c,nodeHandleStrokeStyle:c,nodeHandleRadius:u,nodeHandleClickRadius:o.nodeHandleClickRadius,nodeHandleFillStyle:o.nodeHandleFillStyle,collapsedNodeHandleFillStyle:o.collapsedNodeHandleFillStyle,rowConnectorDash:o.rowConnectorDash,treeStrokeWidth:1},f={charFont:i+"px Menlo,monospace",charFontName:"Menlo,monospace",color:o.color||y[o.colorScheme],nameFontName:"inherit",nameFontSize:s,nameFontColor:"black",genericRowHeight:i};return r.state={config:o,datasets:r.props.datasets||[],computedTreeConfig:d,computedFontConfig:f},r.divRef=a.a.createRef(),r.inputRef=a.a.createRef(),r.msaRef=a.a.createRef(),r}return Object(d.a)(n,[{key:"handleDragEnter",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"handleDragOver",value:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}},{key:"handleDrop",value:function(e){e.stopPropagation(),e.preventDefault(),this.openFiles(e.dataTransfer.files)}},{key:"handleSelectDataset",value:function(e){var t=e.target.value;t?(this.setDataset(this.state.datasets.find((function(e){return e.name===t}))),this.msaRef.current.resetView()):this.inputRef.current.click()}},{key:"handleSelectFile",value:function(e){this.openFiles(e.target.files)}},{key:"openFiles",value:function(e){var t=this;return Promise.all(Array.from(e).map((function(e){return t.openFile(e)})))}},{key:"openFile",value:function(e){var t=this;return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var r=e.target.result;t.addDatasets(r,!0),n()},a.readAsText(e)}))}},{key:"addDatasets",value:function(e,t){var n=this,r=function(e){return"Alignment "+(n.state.datasets.length+(e||0)+1)},a=this.state.datasets;if(this.sniffStockholmRegex.test(e)){var o=R.a.parseAll(e);a=a.concat(o.map((function(e,t){var n;return["DE","ID","AC"].forEach((function(t){!n&&e.gf[t]&&e.gf[t].length&&(n=e.gf[t][0])})),n=n||r(t),{stockholmjs:e,name:n}})))}else try{var i=JSON.parse(e);Object(g.isArray)(i)?a=a.concat(i):a.push(i)}catch(l){a.push({auto:e,name:r()})}if(a.length>this.state.datasets.length){var s=a[this.state.datasets.length];t?this.setDataset(s,{datasets:a}):this.setState({datasets:a}),this.msaRef.current&&this.msaRef.current.resetView()}}},{key:"setDataset",value:function(e,t){var n=this,r=this.datasetsLoaded=(this.datasetsLoaded||0)+1;this.indexData(e).then((function(e){return n.setState(Object(g.extend)({datasetID:r,reconstructingAncestors:!1},e,t||{}))}))}},{key:"indexData",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n){var r,a,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||this.state.config,e.next=3,this.getData(r.cacheData?t:Object(g.extend)({},t),r);case 3:return a=e.sent,o=this.buildTreeIndex(a),i=this.buildAlignmentIndex(a),e.abrupt("return",{data:a,treeIndex:o,alignIndex:i});case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getData",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n){var r,a,o,i,s,l,h,d,f,p,v,m=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.url){e.next=3;break}return e.next=3,Promise.all(Object.keys(t.url).filter((function(e){return!t[e]})).map((function(e){var n=m.makeURL(t.url[e]);return fetch(n).then(function(){var r=Object(u.a)(c.a.mark((function r(a){return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!a.ok){r.next=6;break}return r.next=3,a.text();case 3:t[e]=r.sent,r.next=7;break;case 6:console.warn("Error fetching "+n,a.statusText);case 7:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())})));case 3:if(t.json&&Object(g.extend)(t,"string"===typeof t.json?JSON.parse(t.json):t.json),t.auto)if(this.sniffStockholmRegex.test(t.auto))t.stockholm=t.auto;else if(this.sniffFastaRegex.test(t.auto))t.fasta=t.auto;else try{Object(g.extend)(t,JSON.parse(t.auto))}catch(y){}if(t.branches&&t.rowData){e.next=20;break}if(!t.stockholm){e.next=10;break}this.unpackStockholm(t,n,t.stockholm),e.next=19;break;case 10:if(!t.stockholmjs){e.next=14;break}this.unpackStockholmJS(t,n,t.stockholmjs),e.next=19;break;case 14:if(!t.fasta){e.next=18;break}t.rowData=this.parseFasta(t.fasta),e.next=19;break;case 18:throw new Error("no sequence data");case 19:t.newick||t.newickjs?(r=new E.Newick,a=t.newickjs=t.newickjs||r.parse(t.newick),o=0,i=function(e){return e.name=e.name||"node"+ ++o},t.branches=[],function e(n){n.branchset&&n.branchset.forEach((function(r){t.branches.push([i(n),i(r),Math.max(r.length,0)]),e(r)}))}(a),t.root=i(a)):(s=Object.keys(t.rowData).sort(),l=s.map((function(e){return t.rowData[e]})),console.warn("Estimating phylogenetic tree ("+s.length+" taxa)..."),h=D.a.calcFiniteDistanceMatrix(l),(d=new L.a.RapidNeighborJoining(h,s.map((function(e){return{name:e}})))).run(),f=d.getAsObject(),p=0,v=function(e){return e.taxon=e.taxon||{name:"node"+ ++p},e.taxon.name},t.branches=[],function e(n){n.children.forEach((function(r){t.branches.push([v(n),v(r),Math.max(r.length,0)]),e(r)}))}(f),t.root=v(f));case 20:return this.guessSeqCoords(t),e.abrupt("return",t);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"guessSeqCoords",value:function(e){var t=this;e.seqCoords||(e.seqCoords={}),Object.keys(e.rowData).forEach((function(n){var r=e.rowData[n],a=t.countNonGapChars(r);if(!e.seqCoords[n]){var o=t.nameEncodedCoordRegex.exec(n);if(o){var i=parseInt(o[1]),s=parseInt(o[2]);s+1-i===a&&(e.seqCoords[n]={startPos:i,endPos:s})}}e.seqCoords[n]||(e.seqCoords[n]={startPos:1,endPos:a})}))}},{key:"makeURL",value:function(e){return e.replace("%PUBLIC_URL%",".")}},{key:"unpackStockholm",value:function(e,t,n){var r=R.a.parse(n);this.unpackStockholmJS(e,t,r)}},{key:"unpackStockholmJS",value:function(e,t,n){var r=this,a=e.structure=e.structure||{};e.rowData=n.seqdata,this.guessSeqCoords(e),n.gf.NH&&!e.newick&&(e.newick=n.gf.NH.join("")),n.gs.DR&&!t.structure.noRemoteStructures&&Object.keys(n.gs.DR).forEach((function(t){var o=e.seqCoords[t],i=o.endPos-o.startPos;n.gs.DR[t].forEach((function(e){var n=r.pdbRegex.exec(e);if(n){var o=n[1].toLowerCase(),s=n[2],l=parseInt(n[3]),c=parseInt(n[4]),u=c-l;if(i===u){a[t]=a[t]||[];var h,d=a[t].findIndex((function(e){return e.pdb===o}));d<0?(h={pdb:o,chains:[]},a[t].push(h)):h=a[t][d],h.chains.push({chain:s,startPos:l,endPos:c})}else console.warn("ignoring structure "+o+" ("+l+"..."+c+") since it is not a full-length match to "+t+" ("+u+"!="+i+")")}}))}))}},{key:"componentDidMount",value:function(){this.divRef.current.addEventListener("dragover",this.handleDragOver.bind(this),!1),this.divRef.current.addEventListener("dragenter",this.handleDragEnter.bind(this),!1),this.divRef.current.addEventListener("drop",this.handleDrop.bind(this),!1),this.initDataset()}},{key:"componentWillUnmount",value:function(){this.divRef.current.removeEventListener("dragover",this.handleDragOver.bind(this),!1),this.divRef.current.removeEventListener("dragenter",this.handleDragEnter.bind(this),!1),this.divRef.current.removeEventListener("drop",this.handleDrop.bind(this))}},{key:"componentDidUpdate",value:function(){this.reconstructMissingNodes()}},{key:"initDataset",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.stockholm&&this.addDatasets(this.props.stockholm,!1),!this.props.dataurl){e.next=4;break}return e.next=4,fetch(this.makeURL(this.props.dataurl)).then(function(){var e=Object(u.a)(c.a.mark((function e(n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.ok){e.next=6;break}return e.t0=t,e.next=4,n.text();case 4:e.t1=e.sent,e.t0.addDatasets.call(e.t0,e.t1,!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:(this.props.data||this.state.datasets.length)&&this.setDataset(this.props.data||this.state.datasets[0]);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reconstructMissingNodes",value:function(){var e,t=this,n=this.state.data;if(n){var r=n.branches,a=Object(g.extend)({},n.rowData);if(n.branches.filter((function(e){return"undefined"===typeof a[e[0]]})).length&&!this.state.reconstructingAncestors)if(this.setState({reconstructingAncestors:!0}),window.Worker)console.warn("Reconstructing ancestral sequences in web worker..."),e=C()().getAncestralReconstruction({branches:r,rowData:a,id:this.state.datasetID}).then((function(e){console.warn("Ancestral sequence reconstruction complete"),e.id===t.state.datasetID?t.incorporateAncestralReconstruction(e.ancestralRowData):console.warn("Discarding unused ancestral sequence reconstruction")}));else console.warn("Reconstructing ancestral sequences..."),e=k({branches:r,rowData:a}).then((function(e){t.incorporateAncestralReconstruction(e.ancestralRowData)}))}else e=Promise.resolve();return e}},{key:"fn2workerURL",value:function(e){var t=new Blob(["("+e.toString()+")()"],{type:"application/javascript"});return URL.createObjectURL(t)}},{key:"incorporateAncestralReconstruction",value:function(e){var t=this.state.data,n=Object(g.extend)({},t.rowData,e);Object(g.extend)(t,{rowData:n}),this.setDataset(t)}},{key:"defaultColorScheme",value:function(){return"maeditor"}},{key:"defaultConfig",value:function(){return{treeAlignHeight:400,genericRowHeight:24,nameFontSize:12,containerHeight:"100%",containerWidth:"100%",treeWidth:200,nameDivWidth:200,branchStrokeStyle:"black",nodeHandleRadius:4,nodeHandleClickRadius:40,nodeHandleFillStyle:"white",collapsedNodeHandleFillStyle:"black",rowConnectorDash:[2,2],structure:{width:400,height:400},handler:{},colorScheme:this.defaultColorScheme()}}},{key:"parseFasta",value:function(e){var t,n={},r=/^>(\S+)/;return e.split("\n").forEach((function(e){var a=r.exec(e);a?n[t=a[1]]="":t&&(n[t]=n[t]+e.replace(/[ \t]/g,""))})),n}},{key:"buildTreeIndex",value:function(e){var t=e.branches,n=e.root,r="undefined"!==typeof n,a=this.getRoots(t);if(0===a.length&&(t.length>0||!r))throw new Error("No root nodes");if(r){if(a.indexOf(n)<0)throw new Error("Specified root node is not a root")}else{if(1!==a.length)throw new Error("Multiple possible root nodes, and no root specified");n=a[0]}var o={},i={};o[n]=[],i[n]=0,t.forEach((function(e){var t=e[0],n=e[1],r=e[2];o[t]=o[t]||[],o[n]=o[n]||[],o[t].push(n),i[n]=r}));var s=[],l={},c={},u={},h=0,d=function(e){if(!e)throw new Error("All nodes must be named");if(l[e])throw new Error("All node names must be unique (duplicate '"+e+"')");l[e]=!0,s.push(e)};return function e(t,n){u[t]=("undefined"!==typeof n?u[n]:0)+i[t],h=Math.max(h,u[t]);var r=o[t],a=[];return 2===r.length?(a=a.concat(e(r[0],t)),d(t),a=a.concat(e(r[1],t))):(d(t),r.forEach((function(n){return a=a.concat(e(n,t))}))),c[t]=a,[t].concat(a)}(n),{root:n,branches:t,children:o,descendants:c,branchLength:i,nodes:s,distFromRoot:u,maxDistFromRoot:h}}},{key:"getRoots",value:function(e){var t={},n={};return e.forEach((function(e){var r=Object(s.a)(e,2),a=r[0],o=r[1];t[a]=t[o]=n[o]=!0})),Object.keys(t).filter((function(e){return!n[e]})).sort()}},{key:"buildAlignmentIndex",value:function(e){var t,n=this,r=e.rowData,a={},o={},i={},s={};Object.keys(r).forEach((function(e){var l=r[e];"undefined"!==typeof t&&t!==l.length&&console.error("Inconsistent row lengths"),t=l.length;var c=[],u=0,h=n.rowAsArray(l);o[e]=h.map((function(e,t){"string"===typeof e&&(s[e]=!0);var r=n.isGapChar(e);return r||c.push(t),r?u:u++})),a[e]=h,i[e]=c}));var l=Object.keys(s).sort();return{alignColToSeqPos:o,seqPosToAlignCol:i,rowDataAsArray:a,columns:t,chars:l}}},{key:"isGapChar",value:function(e){return"string"===typeof e?"-"===e||"."===e:!e||0===Object.keys(e).length}},{key:"countNonGapChars",value:function(e){var t=this;return this.rowAsArray(e).filter((function(e){return!t.isGapChar(e)})).length}},{key:"rowAsArray",value:function(e){return"string"===typeof e?e.split(""):e}},{key:"render",value:function(){return a.a.createElement("div",{className:"App",ref:this.divRef},a.a.createElement("div",{className:"MSA-appbar"},a.a.createElement("input",{type:"file",ref:this.inputRef,onChange:this.handleSelectFile.bind(this),style:{display:"none"}}),this.state.data?this.state.datasets.length?a.a.createElement(v.a,{value:this.state.data.name,onChange:this.handleSelectDataset.bind(this)},this.state.datasets.map((function(e){return a.a.createElement(m.a,{key:e.name,value:e.name},e.name)})),a.a.createElement(m.a,{value:""},a.a.createElement("i",null,"Open alignment file"))):a.a.createElement("div",{className:"MSA-appbar-title"},this.state.data.name):"",a.a.createElement("div",{className:"MSA-appbar-link"},a.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/ihh/abrowse"},"GitHub"))),this.state.data&&a.a.createElement(Y,{ref:this.msaRef,data:this.state.data,isGapChar:this.isGapChar.bind(this),config:this.state.config,view:this.state.view,treeIndex:this.state.treeIndex,alignIndex:this.state.alignIndex,computedTreeConfig:this.state.computedTreeConfig,computedFontConfig:this.state.computedFontConfig}))}},{key:"pdbRegex",get:function(){return/PDB; +(\S+) +(\S); ([0-9]+)-([0-9]+)/}},{key:"nameEncodedCoordRegex",get:function(){return/\/([0-9]+)-([0-9]+)$/}},{key:"sniffStockholmRegex",get:function(){return/^# STOCKHOLM/}},{key:"sniffFastaRegex",get:function(){return/^>/}}]),n}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var G={dataurl:"%PUBLIC_URL%/pfam-cov2.stock",config:{containerHeight:"1000px",handler:{click:function(e){console.warn("Click "+e.node+" column "+e.column+(e.isGap?"":", position "+e.seqPos)+" ("+e.c+")")}}}};i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(z,G)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},60:function(e,t,n){var r=n(91),a=["getAncestralReconstruction"];e.exports=function(){var e=new Worker(n.p+"49e0c98df6571801ee9b.worker.js",{name:"[hash].worker.js"});return r(e,a),e}},74:function(e,t,n){e.exports=n(104)},79:function(e,t,n){},82:function(e,t,n){}},[[74,1,2]]]);
//# sourceMappingURL=main.78e8e0cf.chunk.js.map